<!doctype html><html lang="ko-KR" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Member 모듈 리펙토링 - 1단계" /><meta property="og:locale" content="ko_KR" /><meta name="description" content="프로젝트 때 만든 Member 모듈을 재사용이 가능하도록 완성하는 과정" /><meta property="og:description" content="프로젝트 때 만든 Member 모듈을 재사용이 가능하도록 완성하는 과정" /><link rel="canonical" href="https://backnback.github.io/posts/member-module-2/" /><meta property="og:url" content="https://backnback.github.io/posts/member-module-2/" /><meta property="og:site_name" content="리버" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2025-02-17T14:00:00+09:00" /><meta property="og:image" content="https://backnback.github.io/assets/img/profile.jpg" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://backnback.github.io/assets/img/profile.jpg" /><meta property="twitter:title" content="Member 모듈 리펙토링 - 1단계" /><meta name="google-site-verification" content="googlea7baca2291ff3812.html" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-02-17T14:00:00+09:00","datePublished":"2025-02-17T14:00:00+09:00","description":"프로젝트 때 만든 Member 모듈을 재사용이 가능하도록 완성하는 과정","headline":"Member 모듈 리펙토링 - 1단계","mainEntityOfPage":{"@type":"WebPage","@id":"https://backnback.github.io/posts/member-module-2/"},"url":"https://backnback.github.io/posts/member-module-2/"}</script><title>Member 모듈 리펙토링 - 1단계 | 리버</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="리버"><meta name="application-name" content="리버"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/ko.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script async src="/assets/js/data/mathjax.js"></script> <script async src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script> <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-chtml.js"></script> <script> let pv = document.getElementById('pageviews'); if (pv !== null) { const uri = location.pathname.replace(/\/$/, ''); const url = `https://blogcounterbacknback.goatcounter.com/counter/${encodeURIComponent(uri)}.json`; fetch(url) .then((response) => response.json()) .then((data) => { const count = data.count.replace(/\s/g, ''); pv.innerText = new Intl.NumberFormat().format(count); }) .catch((error) => { pv.innerText = '1'; }); } </script> <script defer src="/app.min.js?baseurl=&register=true" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-9ZSXFFWEB4"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-9ZSXFFWEB4'); }); </script> <script async src="https://gc.zgo.at/count.js" data-goatcounter="https://blogcounterbacknback.goatcounter.com/count" ></script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/assets/img/profile.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">리버</a><p class="site-subtitle fst-italic mb-0">Backend 개발자</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>홈</span> </a><li class="nav-item"> <a href="/posts/" class="nav-link"> <i class="fa-fw fas fa-feather-alt"></i> <span>게시글</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>카테고리</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>태그</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>아카이브</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>정보</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/backnback" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="https://twitter.com/" aria-label="twitter" target="_blank" rel="noopener noreferrer" > <i class="fa-brands fa-x-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['garam8796','naver.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">홈</a> </span> <span>Member 모듈 리펙토링 - 1단계</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> 포스트</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="검색..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">취소</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>Member 모듈 리펙토링 - 1단계</h1><p class="post-desc fw-light mb-4">프로젝트 때 만든 Member 모듈을 재사용이 가능하도록 완성하는 과정</p><div class="post-meta text-muted"> <span> 게시 <time data-ts="1739768400" data-df="YYYY/MM/DD" data-bs-toggle="tooltip" data-bs-placement="bottom" > 2025/02/17 </time> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/backnback">이가람</a> </em> </span><div> <span> <em id="pageviews"> <i class="fas fa-spinner fa-spin small"></i> </em> 조회 </span> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="4599 단어" > <em>25 분</em>읽는 시간</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">Member 모듈 리펙토링 - 1단계</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">바로가기</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">Member 모듈 리펙토링 - 1단계</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"><h2 id="리펙토링-1단계-----"><span class="me-2">리펙토링 1단계   :   -</span><a href="#리펙토링-1단계-----" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><br /> <br /> <br /> <br /></p><h2 id="리펙토링-2단계----socialaccount-entity-변경"><span class="me-2">리펙토링 2단계   :   SocialAccount Entity 변경</span><a href="#리펙토링-2단계----socialaccount-entity-변경" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="-socialaccount--oauthprovider로-entity-변경"><span class="me-2">⭕ SocialAccount ⇨ OAuthProvider로 Entity 변경</span><a href="#-socialaccount--oauthprovider로-entity-변경" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><p><span class="class class-1">SocialAccount</span></p><details> <summary><code class="code">Code 보기</code></summary><div><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
</pre><td class="rouge-code"><pre>  <span class="kn">package</span> <span class="nn">com.msa.member.domain.member.auth.entity</span><span class="o">;</span>
    
  <span class="kn">import</span> <span class="nn">com.msa.member.domain.member.member.entity.Member</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">com.msa.member.domain.member.member.enums.ProviderType</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">jakarta.persistence.*</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">lombok.*</span><span class="o">;</span>
    
  <span class="kn">import</span> <span class="nn">java.time.LocalDateTime</span><span class="o">;</span>
    
  <span class="nd">@Entity</span>
  <span class="nd">@Setter</span>
  <span class="nd">@Getter</span>
  <span class="nd">@AllArgsConstructor</span>
  <span class="nd">@NoArgsConstructor</span>
  <span class="nd">@Builder</span>
  <span class="nd">@EqualsAndHashCode</span><span class="o">(</span><span class="n">onlyExplicitlyIncluded</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">SocialAccount</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>
    
    <span class="nd">@MapsId</span>
    <span class="nd">@OneToOne</span>
    <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"id"</span><span class="o">)</span>
    <span class="nd">@EqualsAndHashCode</span><span class="o">.</span><span class="na">Include</span>
    <span class="kd">private</span> <span class="nc">Member</span> <span class="n">member</span><span class="o">;</span>
    
    <span class="c1">// Kakao</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">unique</span> <span class="o">=</span> <span class="kc">true</span><span class="o">,</span> <span class="n">length</span> <span class="o">=</span> <span class="mi">50</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">kakaoProviderId</span><span class="o">;</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">unique</span> <span class="o">=</span> <span class="kc">true</span><span class="o">,</span> <span class="n">length</span> <span class="o">=</span> <span class="mi">50</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">kakaoEmail</span><span class="o">;</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="nd">@Builder</span><span class="o">.</span><span class="na">Default</span>
    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">kakaoActive</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
    <span class="nd">@Setter</span><span class="o">(</span><span class="nc">AccessLevel</span><span class="o">.</span><span class="na">PRIVATE</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">LocalDateTime</span> <span class="n">kakaoCreateDate</span><span class="o">;</span>
    <span class="nd">@Setter</span><span class="o">(</span><span class="nc">AccessLevel</span><span class="o">.</span><span class="na">PRIVATE</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">LocalDateTime</span> <span class="n">kakaoModifyDate</span><span class="o">;</span>
    
    <span class="c1">// Google</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">length</span> <span class="o">=</span> <span class="mi">50</span><span class="o">,</span> <span class="n">unique</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">googleProviderId</span><span class="o">;</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">unique</span> <span class="o">=</span> <span class="kc">true</span><span class="o">,</span> <span class="n">length</span> <span class="o">=</span> <span class="mi">50</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">googleEmail</span><span class="o">;</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="nd">@Builder</span><span class="o">.</span><span class="na">Default</span>
    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">googleActive</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
    <span class="nd">@Setter</span><span class="o">(</span><span class="nc">AccessLevel</span><span class="o">.</span><span class="na">PRIVATE</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">LocalDateTime</span> <span class="n">googleCreateDate</span><span class="o">;</span>
    <span class="nd">@Setter</span><span class="o">(</span><span class="nc">AccessLevel</span><span class="o">.</span><span class="na">PRIVATE</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">LocalDateTime</span> <span class="n">googleModifyDate</span><span class="o">;</span>
    
    <span class="c1">// Github</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">length</span> <span class="o">=</span> <span class="mi">50</span><span class="o">,</span> <span class="n">unique</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">githubProviderId</span><span class="o">;</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">unique</span> <span class="o">=</span> <span class="kc">true</span><span class="o">,</span> <span class="n">length</span> <span class="o">=</span> <span class="mi">50</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">githubEmail</span><span class="o">;</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="nd">@Builder</span><span class="o">.</span><span class="na">Default</span>
    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">githubActive</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
    <span class="nd">@Setter</span><span class="o">(</span><span class="nc">AccessLevel</span><span class="o">.</span><span class="na">PRIVATE</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">LocalDateTime</span> <span class="n">githubCreateDate</span><span class="o">;</span>
    <span class="nd">@Setter</span><span class="o">(</span><span class="nc">AccessLevel</span><span class="o">.</span><span class="na">PRIVATE</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">LocalDateTime</span> <span class="n">githubModifyDate</span><span class="o">;</span>
    
    <span class="c1">// Naver</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">length</span> <span class="o">=</span> <span class="mi">150</span><span class="o">,</span> <span class="n">unique</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">naverProviderId</span><span class="o">;</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">unique</span> <span class="o">=</span> <span class="kc">true</span><span class="o">,</span> <span class="n">length</span> <span class="o">=</span> <span class="mi">50</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">naverEmail</span><span class="o">;</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="nd">@Builder</span><span class="o">.</span><span class="na">Default</span>
    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">naverActive</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
    <span class="nd">@Setter</span><span class="o">(</span><span class="nc">AccessLevel</span><span class="o">.</span><span class="na">PRIVATE</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">LocalDateTime</span> <span class="n">naverCreateDate</span><span class="o">;</span>
    <span class="nd">@Setter</span><span class="o">(</span><span class="nc">AccessLevel</span><span class="o">.</span><span class="na">PRIVATE</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">LocalDateTime</span> <span class="n">naverModifyDate</span><span class="o">;</span>
    
    <span class="c1">// 공통</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">hasSocialAccount</span><span class="o">(</span><span class="nc">ProviderType</span> <span class="n">provider</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">provider</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
      <span class="o">}</span>
    
      <span class="k">return</span> <span class="nf">switch</span> <span class="o">(</span><span class="n">provider</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">case</span> <span class="nc">ProviderType</span><span class="o">.</span><span class="na">KAKAO</span> <span class="o">-&gt;</span> <span class="n">kakaoActive</span><span class="o">;</span>
        <span class="k">case</span> <span class="nc">ProviderType</span><span class="o">.</span><span class="na">GOOGLE</span> <span class="o">-&gt;</span> <span class="n">googleActive</span><span class="o">;</span>
        <span class="k">case</span> <span class="nc">ProviderType</span><span class="o">.</span><span class="na">GITHUB</span> <span class="o">-&gt;</span> <span class="n">githubActive</span><span class="o">;</span>
        <span class="k">case</span> <span class="nc">ProviderType</span><span class="o">.</span><span class="na">NAVER</span> <span class="o">-&gt;</span> <span class="n">naverActive</span><span class="o">;</span>
        <span class="k">default</span> <span class="o">-&gt;</span> <span class="kc">false</span><span class="o">;</span>
      <span class="o">};</span>
    <span class="o">}</span>
    
    <span class="c1">// Kakao</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">updateKakaoInfo</span><span class="o">(</span><span class="nc">String</span> <span class="n">providerId</span><span class="o">,</span> <span class="nc">String</span> <span class="n">email</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">active</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">kakaoProviderId</span> <span class="o">=</span> <span class="n">providerId</span><span class="o">;</span>
      <span class="n">kakaoEmail</span> <span class="o">=</span> <span class="n">email</span><span class="o">;</span>
      <span class="n">kakaoActive</span> <span class="o">=</span> <span class="n">active</span><span class="o">;</span>
      <span class="n">kakaoModifyDate</span> <span class="o">=</span> <span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">();</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">connectKakao</span><span class="o">(</span><span class="nc">String</span> <span class="n">providerId</span><span class="o">,</span> <span class="nc">String</span> <span class="n">email</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">kakaoCreateDate</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">kakaoCreateDate</span> <span class="o">=</span> <span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">();</span>
      <span class="o">}</span>
      <span class="n">updateKakaoInfo</span><span class="o">(</span><span class="n">providerId</span><span class="o">,</span> <span class="n">email</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">disconnectKakao</span><span class="o">()</span> <span class="o">{</span>
      <span class="n">updateKakaoInfo</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
    <span class="o">}</span>
    
    <span class="c1">// Google</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">updateGoogleInfo</span><span class="o">(</span><span class="nc">String</span> <span class="n">providerId</span><span class="o">,</span> <span class="nc">String</span> <span class="n">email</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">active</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">googleProviderId</span> <span class="o">=</span> <span class="n">providerId</span><span class="o">;</span>
      <span class="n">googleEmail</span> <span class="o">=</span> <span class="n">email</span><span class="o">;</span>
      <span class="n">googleActive</span> <span class="o">=</span> <span class="n">active</span><span class="o">;</span>
      <span class="n">googleModifyDate</span> <span class="o">=</span> <span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">();</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">connectGoogle</span><span class="o">(</span><span class="nc">String</span> <span class="n">providerId</span><span class="o">,</span> <span class="nc">String</span> <span class="n">email</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">googleCreateDate</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">googleCreateDate</span> <span class="o">=</span> <span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">();</span>
      <span class="o">}</span>
      <span class="n">updateGoogleInfo</span><span class="o">(</span><span class="n">providerId</span><span class="o">,</span> <span class="n">email</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">disconnectGoogle</span><span class="o">()</span> <span class="o">{</span>
      <span class="n">updateGoogleInfo</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
    <span class="o">}</span>
    
    <span class="c1">// Github</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">updateGithubInfo</span><span class="o">(</span><span class="nc">String</span> <span class="n">providerId</span><span class="o">,</span> <span class="nc">String</span> <span class="n">email</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">active</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">githubProviderId</span> <span class="o">=</span> <span class="n">providerId</span><span class="o">;</span>
      <span class="n">githubEmail</span> <span class="o">=</span> <span class="n">email</span><span class="o">;</span>
      <span class="n">githubActive</span> <span class="o">=</span> <span class="n">active</span><span class="o">;</span>
      <span class="n">githubModifyDate</span> <span class="o">=</span> <span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">();</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">connectGithub</span><span class="o">(</span><span class="nc">String</span> <span class="n">providerId</span><span class="o">,</span> <span class="nc">String</span> <span class="n">email</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">githubCreateDate</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">githubCreateDate</span> <span class="o">=</span> <span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">();</span>
      <span class="o">}</span>
      <span class="n">updateGithubInfo</span><span class="o">(</span><span class="n">providerId</span><span class="o">,</span> <span class="n">email</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">disconnectGithub</span><span class="o">()</span> <span class="o">{</span>
      <span class="n">updateGithubInfo</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
    <span class="o">}</span>
    
    <span class="c1">// Naver</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">updateNaverInfo</span><span class="o">(</span><span class="nc">String</span> <span class="n">providerId</span><span class="o">,</span> <span class="nc">String</span> <span class="n">email</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">active</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">naverProviderId</span> <span class="o">=</span> <span class="n">providerId</span><span class="o">;</span>
      <span class="n">naverEmail</span> <span class="o">=</span> <span class="n">email</span><span class="o">;</span>
      <span class="n">naverActive</span> <span class="o">=</span> <span class="n">active</span><span class="o">;</span>
      <span class="n">naverModifyDate</span> <span class="o">=</span> <span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">();</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">connectNaver</span><span class="o">(</span><span class="nc">String</span> <span class="n">providerId</span><span class="o">,</span> <span class="nc">String</span> <span class="n">email</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">naverCreateDate</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">naverCreateDate</span> <span class="o">=</span> <span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">();</span>
      <span class="o">}</span>
      <span class="n">updateNaverInfo</span><span class="o">(</span><span class="n">providerId</span><span class="o">,</span> <span class="n">email</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">disconnectNaver</span><span class="o">()</span> <span class="o">{</span>
      <span class="n">updateNaverInfo</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
    
</pre></table></code></div></div></div></details></ul><p><br /></p><p><br /></p><p><br /></p><p><br /></p><h2 id="-entity-layer"><span class="me-2">👉 Entity Layer</span><a href="#-entity-layer" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="-baseentity"><span class="me-2">🔆 BaseEntity</span><a href="#-baseentity" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><span class="class class-1">BaseEntity</span><ul><li><p>다른 모든 Entity에서 자주 사용되는 필드를 뽑아 놓은 추상클래스</p><details> <summary><code class="code">Code 보기</code></summary><div><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre><td class="rouge-code"><pre>  <span class="kn">import</span> <span class="nn">jakarta.persistence.*</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">lombok.*</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">lombok.experimental.SuperBuilder</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">org.springframework.data.annotation.CreatedDate</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">org.springframework.data.annotation.LastModifiedDate</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">org.springframework.data.jpa.domain.support.AuditingEntityListener</span><span class="o">;</span>
        
  <span class="kn">import</span> <span class="nn">java.time.LocalDateTime</span><span class="o">;</span>
        
  <span class="kn">import</span> <span class="nn">static</span> <span class="n">jakarta</span><span class="o">.</span><span class="na">persistence</span><span class="o">.</span><span class="na">GenerationType</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">static</span> <span class="n">lombok</span><span class="o">.</span><span class="na">AccessLevel</span><span class="o">.</span><span class="na">PROTECTED</span><span class="o">;</span>
        
  <span class="nd">@MappedSuperclass</span>  <span class="c1">// 상속 관계 매핑용 부모 클래스</span>
  <span class="nd">@NoArgsConstructor</span><span class="o">(</span><span class="n">access</span> <span class="o">=</span> <span class="no">PROTECTED</span><span class="o">)</span>  <span class="c1">// 외부에서 생성 제한</span>
  <span class="nd">@AllArgsConstructor</span><span class="o">(</span><span class="n">access</span> <span class="o">=</span> <span class="no">PROTECTED</span><span class="o">)</span> <span class="c1">// 자식 클래스에서만 모든 필드 생성자 사용 가능</span>
  <span class="nd">@Getter</span>
  <span class="nd">@SuperBuilder</span>  <span class="c1">// 자식 클래스에서 빌더 패턴 사용 가능</span>
  <span class="nd">@EntityListeners</span><span class="o">(</span><span class="nc">AuditingEntityListener</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>  <span class="c1">// JPA Auditing 기능 활성화</span>
  <span class="nd">@EqualsAndHashCode</span><span class="o">(</span><span class="n">onlyExplicitlyIncluded</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>  <span class="c1">// ID 필드만 equals, hashCode 비교</span>
  <span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">BaseEntity</span> <span class="o">{</span>  <span class="c1">// abstract로 선언하여 직접 생성 방지</span>
        
    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="no">IDENTITY</span><span class="o">)</span>
    <span class="nd">@EqualsAndHashCode</span><span class="o">.</span><span class="na">Include</span>  <span class="c1">// equals, hashCode에 이 필드만 포함</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>
        
    <span class="nd">@CreatedDate</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">updatable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>  <span class="c1">// 생성일은 수정 불가</span>
    <span class="kd">private</span> <span class="nc">LocalDateTime</span> <span class="n">createDate</span><span class="o">;</span>
        
    <span class="nd">@LastModifiedDate</span>  <span class="c1">// 엔티티 수정시 자동 업데이트</span>
    <span class="kd">private</span> <span class="nc">LocalDateTime</span> <span class="n">modifiedDate</span><span class="o">;</span>
  <span class="o">}</span>
        
</pre></table></code></div></div></div></details><ul><li>ID 생성, 시간 관리 등 공통 관심사 분리<li>JPA 최적화 (ID 필드만 비교)<li>불변성 보장 (Setter 없음)<li>생성자 제한으로 안전성 보장<li>자동 감사(Audit) 기능</ul></ul></ul><p><br /></p><p><br /></p><p><br /></p><h3 id="-baseoauthprovider"><span class="me-2">🔆 BaseOAuthProvider</span><a href="#-baseoauthprovider" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><span class="class class-2">BaseOAuthProvider</span><ul><li>OAuth2 Provider들의 공통 동작 정의 (추상 클래스)<ul><li>즉, 아래의 소셜 로그인 제공자별 Embedded 클래스의 공통 로직을 추출한 추상 클래스이다.</ul><li><code class="language-plaintext highlighter-rouge">connect()</code>, <code class="language-plaintext highlighter-rouge">disconnect()</code> 등 공통 로직 제공<li><span class="GoF">[GoF] Template Method</span><li><p>자식클래스에서 추상 메서드를 각 소셜 로그인 제공자별로 각각 구현한다.</p><details> <summary><code class="code">Code 보기</code></summary><div><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre><td class="rouge-code"><pre>  <span class="kn">package</span> <span class="nn">com.msa.member.domain.member.auth.entity</span><span class="o">;</span>
        
  <span class="kn">import</span> <span class="nn">jakarta.persistence.MappedSuperclass</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">lombok.AccessLevel</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">lombok.Getter</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">lombok.NoArgsConstructor</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">lombok.experimental.SuperBuilder</span><span class="o">;</span>
        
  <span class="kn">import</span> <span class="nn">java.time.LocalDateTime</span><span class="o">;</span>
        
  <span class="nd">@MappedSuperclass</span>
  <span class="nd">@Getter</span>
  <span class="nd">@SuperBuilder</span>
  <span class="nd">@NoArgsConstructor</span><span class="o">(</span><span class="n">access</span> <span class="o">=</span> <span class="nc">AccessLevel</span><span class="o">.</span><span class="na">PROTECTED</span><span class="o">)</span>
  <span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">BaseOAuthProvider</span> <span class="o">{</span>
        
  <span class="kd">protected</span> <span class="kd">abstract</span> <span class="nc">String</span> <span class="nf">getProviderId</span><span class="o">();</span>
  <span class="kd">protected</span> <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">setConnected</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">connected</span><span class="o">);</span>
  <span class="kd">protected</span> <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">setConnectedDate</span><span class="o">(</span><span class="nc">LocalDateTime</span> <span class="n">connectedDate</span><span class="o">);</span>
  <span class="kd">protected</span> <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">setModifiedDate</span><span class="o">(</span><span class="nc">LocalDateTime</span> <span class="n">modifiedDate</span><span class="o">);</span>
        
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">connect</span><span class="o">()</span> <span class="o">{</span>
      <span class="n">setConnected</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
      <span class="n">setConnectedDate</span><span class="o">(</span><span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">());</span>
      <span class="n">setModifiedDate</span><span class="o">(</span><span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">());</span>
  <span class="o">}</span>
        
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">disconnect</span><span class="o">()</span> <span class="o">{</span>
      <span class="n">setConnected</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
      <span class="n">setModifiedDate</span><span class="o">(</span><span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">());</span>
  <span class="o">}</span>
        
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">validate</span><span class="o">()</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">getProviderId</span><span class="o">()</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">getProviderId</span><span class="o">().</span><span class="na">isBlank</span><span class="o">())</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span><span class="s">"Provider ID가 유효하지 않습니다."</span><span class="o">);</span>
      <span class="o">}</span>
  <span class="o">}</span>
  <span class="o">}</span>
        
</pre></table></code></div></div></div></details></ul></ul><p><br /></p><p><br /></p><p><br /></p><h3 id="-kakaoprovider-googleprovider-naverprovider-githubprovider"><span class="me-2">🔆 KakaoProvider, GoogleProvider, NaverProvider, GithubProvider</span><a href="#-kakaoprovider-googleprovider-naverprovider-githubprovider" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><span class="class class-3">KakaoProvider</span><ul><li>각각의 클래스는 OAuthProvider의 Embedded 클래스이다.<ul><li>즉, DB에서 각 클래스의 필드들은 OAuthProvider의 속성으로 들어간다.</ul><li><code class="language-plaintext highlighter-rouge">setConnected()</code>, <code class="language-plaintext highlighter-rouge">setConnectedDate()</code>, <code class="language-plaintext highlighter-rouge">setModifiedDate()</code> 추상메서드 구현<li><p><span class="GoF">[GoF] Template Method</span> 패턴을 사용한 이유는 모든 제공자에서 공통으로</p><p>사용되는 <code class="language-plaintext highlighter-rouge">connect()</code>, <code class="language-plaintext highlighter-rouge">disconnect()</code>, <code class="language-plaintext highlighter-rouge">validate()</code>를 공통 로직으로 사용하기 위해서이다.</p><p>필요한 요소들을 미리 가져다 쓰고 메서드 내부 구현은 자식 클래스에게 맡기는 것이다.</p><details> <summary><code class="code">Code 보기</code></summary><div><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
</pre><td class="rouge-code"><pre>  <span class="kn">package</span> <span class="nn">com.msa.member.domain.member.auth.entity</span><span class="o">;</span>
        
  <span class="kn">import</span> <span class="nn">jakarta.persistence.Column</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">jakarta.persistence.Embeddable</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">lombok.*</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">lombok.experimental.SuperBuilder</span><span class="o">;</span>
        
  <span class="kn">import</span> <span class="nn">java.time.LocalDateTime</span><span class="o">;</span>
        
  <span class="nd">@Embeddable</span>
  <span class="nd">@Getter</span>
  <span class="nd">@SuperBuilder</span>
  <span class="nd">@AllArgsConstructor</span><span class="o">(</span><span class="n">access</span> <span class="o">=</span> <span class="nc">AccessLevel</span><span class="o">.</span><span class="na">PROTECTED</span><span class="o">)</span>
  <span class="nd">@NoArgsConstructor</span><span class="o">(</span><span class="n">access</span> <span class="o">=</span> <span class="nc">AccessLevel</span><span class="o">.</span><span class="na">PROTECTED</span><span class="o">)</span>
  <span class="nd">@EqualsAndHashCode</span><span class="o">(</span><span class="n">of</span> <span class="o">=</span> <span class="s">"providerId"</span><span class="o">,</span> <span class="n">callSuper</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">KakaoProvider</span> <span class="kd">extends</span> <span class="nc">BaseOAuthProvider</span> <span class="o">{</span>
        
  <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"kakao_provider_id"</span><span class="o">,</span> <span class="n">length</span> <span class="o">=</span> <span class="mi">50</span><span class="o">)</span>
  <span class="kd">private</span> <span class="nc">String</span> <span class="n">providerId</span><span class="o">;</span>
        
  <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"kakao_email"</span><span class="o">,</span> <span class="n">length</span> <span class="o">=</span> <span class="mi">50</span><span class="o">)</span>
  <span class="kd">private</span> <span class="nc">String</span> <span class="n">email</span><span class="o">;</span>
        
  <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"kakao_connected"</span><span class="o">)</span>
  <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">connected</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        
  <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"kakao_connected_date"</span><span class="o">)</span>
  <span class="kd">private</span> <span class="nc">LocalDateTime</span> <span class="n">connectedDate</span><span class="o">;</span>
        
  <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"kakao_modified_date"</span><span class="o">)</span>
  <span class="kd">private</span> <span class="nc">LocalDateTime</span> <span class="n">modifiedDate</span><span class="o">;</span>
        
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">connect</span><span class="o">(</span><span class="nc">String</span> <span class="n">providerId</span><span class="o">,</span> <span class="nc">String</span> <span class="n">email</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">providerId</span> <span class="o">=</span> <span class="n">providerId</span><span class="o">;</span>
      <span class="k">this</span><span class="o">.</span><span class="na">email</span> <span class="o">=</span> <span class="n">email</span><span class="o">;</span>
      <span class="kd">super</span><span class="o">.</span><span class="na">connect</span><span class="o">();</span>
  <span class="o">}</span>
        
  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">setConnected</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">connected</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">connected</span> <span class="o">=</span> <span class="n">connected</span><span class="o">;</span>
  <span class="o">}</span>
        
  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">setConnectedDate</span><span class="o">(</span><span class="nc">LocalDateTime</span> <span class="n">connectedDate</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">connectedDate</span> <span class="o">=</span> <span class="n">connectedDate</span><span class="o">;</span>
  <span class="o">}</span>
        
  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">setModifiedDate</span><span class="o">(</span><span class="nc">LocalDateTime</span> <span class="n">modifiedDate</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">modifiedDate</span> <span class="o">=</span> <span class="n">modifiedDate</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="o">}</span>
        
</pre></table></code></div></div></div></details><li>이 클래스들의 목적은 소셜 로그인 정보를 담고 있는 것이다.</ul></ul><p><br /></p><p><br /></p><p><br /></p><h3 id="-oauthprovider"><span class="me-2">🔆 OAuthProvider</span><a href="#-oauthprovider" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><span class="class class-4">OAuthProvider</span><ul><li>모든 소셜 로그인 제공자들을 통합 관리하는 Entity이다.<ul><li>즉, 위의 각 제공자별 Embedded 클래스를 모두 관리한다.</ul><li>Embedded된 Provider들의 추가/제거는 여기서 모두 처리하여 통합 관리한다.<li>Member 엔티티와는 1대1 관계이다.<li><p>Embedded 클래스에서 직접 Unique Key를 지정할 수 없다. 바깥 클래스에서 지정 지정했다.</p><details> <summary><code class="code">Code 보기</code></summary><div><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
</pre><td class="rouge-code"><pre>  <span class="kn">package</span> <span class="nn">com.msa.member.domain.member.auth.entity</span><span class="o">;</span>
        
  <span class="kn">import</span> <span class="nn">com.msa.member.domain.member.member.dto.OAuthProviderStatus</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">com.msa.member.domain.member.member.entity.Member</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">com.msa.member.domain.member.member.enums.ProviderType</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">com.msa.member.global.jpa.BaseEntity</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">jakarta.persistence.*</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">lombok.*</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">lombok.experimental.SuperBuilder</span><span class="o">;</span>
        
  <span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>
        
  <span class="nd">@Entity</span>
  <span class="nd">@Getter</span>
  <span class="nd">@NoArgsConstructor</span><span class="o">(</span><span class="n">access</span> <span class="o">=</span> <span class="nc">AccessLevel</span><span class="o">.</span><span class="na">PROTECTED</span><span class="o">)</span>
  <span class="nd">@AllArgsConstructor</span><span class="o">(</span><span class="n">access</span> <span class="o">=</span> <span class="nc">AccessLevel</span><span class="o">.</span><span class="na">PROTECTED</span><span class="o">)</span>
  <span class="nd">@SuperBuilder</span>
  <span class="nd">@EqualsAndHashCode</span><span class="o">(</span><span class="n">onlyExplicitlyIncluded</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
  <span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"oauth_providers"</span><span class="o">,</span> <span class="n">uniqueConstraints</span> <span class="o">=</span> <span class="o">{</span>
      <span class="nd">@UniqueConstraint</span><span class="o">(</span><span class="n">columnNames</span> <span class="o">=</span> <span class="s">"kakao_provider_id"</span><span class="o">),</span>
      <span class="nd">@UniqueConstraint</span><span class="o">(</span><span class="n">columnNames</span> <span class="o">=</span> <span class="s">"google_provider_id"</span><span class="o">),</span>
      <span class="nd">@UniqueConstraint</span><span class="o">(</span><span class="n">columnNames</span> <span class="o">=</span> <span class="s">"naver_provider_id"</span><span class="o">),</span>
      <span class="nd">@UniqueConstraint</span><span class="o">(</span><span class="n">columnNames</span> <span class="o">=</span> <span class="s">"github_provider_id"</span><span class="o">)</span>
  <span class="o">})</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">OAuthProvider</span> <span class="kd">extends</span> <span class="nc">BaseEntity</span> <span class="o">{</span>
        
  <span class="nd">@MapsId</span>
  <span class="nd">@OneToOne</span>
  <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"member_id"</span><span class="o">)</span>
  <span class="nd">@EqualsAndHashCode</span><span class="o">.</span><span class="na">Include</span>
  <span class="kd">private</span> <span class="nc">Member</span> <span class="n">member</span><span class="o">;</span>
        
  <span class="c1">// 소셜 계정 정보</span>
  <span class="nd">@Embedded</span>
  <span class="kd">private</span> <span class="nc">KakaoProvider</span> <span class="n">kakao</span><span class="o">;</span>
        
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addKakaoProvider</span><span class="o">(</span><span class="nc">String</span> <span class="n">providerId</span><span class="o">,</span> <span class="nc">String</span> <span class="n">email</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">KakaoProvider</span> <span class="n">kakaoProvider</span> <span class="o">=</span> <span class="nc">KakaoProvider</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
          <span class="o">.</span><span class="na">providerId</span><span class="o">(</span><span class="n">providerId</span><span class="o">)</span>
          <span class="o">.</span><span class="na">email</span><span class="o">(</span><span class="n">email</span><span class="o">)</span>
          <span class="o">.</span><span class="na">build</span><span class="o">();</span>
      <span class="n">kakaoProvider</span><span class="o">.</span><span class="na">connect</span><span class="o">();</span>
      <span class="n">kakao</span> <span class="o">=</span> <span class="n">kakaoProvider</span><span class="o">;</span>
  <span class="o">}</span>
        
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">removeKakaoProvider</span><span class="o">()</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">kakao</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">kakao</span><span class="o">.</span><span class="na">disconnect</span><span class="o">();</span>
      <span class="n">kakao</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
      <span class="o">}</span>
  <span class="o">}</span>
        
  <span class="nd">@Embedded</span>
  <span class="kd">private</span> <span class="nc">GoogleProvider</span> <span class="n">google</span><span class="o">;</span>
        
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addGoogleProvider</span><span class="o">(</span><span class="nc">String</span> <span class="n">providerId</span><span class="o">,</span> <span class="nc">String</span> <span class="n">email</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">GoogleProvider</span> <span class="n">googleProvider</span> <span class="o">=</span> <span class="nc">GoogleProvider</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
          <span class="o">.</span><span class="na">providerId</span><span class="o">(</span><span class="n">providerId</span><span class="o">)</span>
          <span class="o">.</span><span class="na">email</span><span class="o">(</span><span class="n">email</span><span class="o">)</span>
          <span class="o">.</span><span class="na">build</span><span class="o">();</span>
      <span class="n">googleProvider</span><span class="o">.</span><span class="na">connect</span><span class="o">();</span>
      <span class="n">google</span> <span class="o">=</span> <span class="n">googleProvider</span><span class="o">;</span>
  <span class="o">}</span>
        
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">removeGoogleProvider</span><span class="o">()</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">google</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">google</span><span class="o">.</span><span class="na">disconnect</span><span class="o">();</span>
      <span class="n">google</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
      <span class="o">}</span>
  <span class="o">}</span>
        
  <span class="nd">@Embedded</span>
  <span class="kd">private</span> <span class="nc">NaverProvider</span> <span class="n">naver</span><span class="o">;</span>
        
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addNaverProvider</span><span class="o">(</span><span class="nc">String</span> <span class="n">providerId</span><span class="o">,</span> <span class="nc">String</span> <span class="n">email</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">NaverProvider</span> <span class="n">naverProvider</span> <span class="o">=</span> <span class="nc">NaverProvider</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
          <span class="o">.</span><span class="na">providerId</span><span class="o">(</span><span class="n">providerId</span><span class="o">)</span>
          <span class="o">.</span><span class="na">email</span><span class="o">(</span><span class="n">email</span><span class="o">)</span>
          <span class="o">.</span><span class="na">build</span><span class="o">();</span>
      <span class="n">naverProvider</span><span class="o">.</span><span class="na">connect</span><span class="o">();</span>
      <span class="n">naver</span> <span class="o">=</span> <span class="n">naverProvider</span><span class="o">;</span>
  <span class="o">}</span>
        
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">removeNaverProvider</span><span class="o">()</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">naver</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">naver</span><span class="o">.</span><span class="na">disconnect</span><span class="o">();</span>
      <span class="n">naver</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
      <span class="o">}</span>
  <span class="o">}</span>
        
  <span class="nd">@Embedded</span>
  <span class="kd">private</span> <span class="nc">GithubProvider</span> <span class="n">github</span><span class="o">;</span>
        
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addGithubProvider</span><span class="o">(</span><span class="nc">String</span> <span class="n">providerId</span><span class="o">,</span> <span class="nc">String</span> <span class="n">email</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">GithubProvider</span> <span class="n">githubProvider</span> <span class="o">=</span> <span class="nc">GithubProvider</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
          <span class="o">.</span><span class="na">providerId</span><span class="o">(</span><span class="n">providerId</span><span class="o">)</span>
          <span class="o">.</span><span class="na">email</span><span class="o">(</span><span class="n">email</span><span class="o">)</span>
          <span class="o">.</span><span class="na">build</span><span class="o">();</span>
      <span class="n">githubProvider</span><span class="o">.</span><span class="na">connect</span><span class="o">();</span>
      <span class="n">github</span> <span class="o">=</span> <span class="n">githubProvider</span><span class="o">;</span>
  <span class="o">}</span>
        
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">removeGithubProvider</span><span class="o">()</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">github</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">github</span><span class="o">.</span><span class="na">disconnect</span><span class="o">();</span>
      <span class="n">github</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
      <span class="o">}</span>
  <span class="o">}</span>
        
  <span class="nd">@Builder</span>
  <span class="kd">private</span> <span class="nf">OAuthProvider</span><span class="o">(</span><span class="nc">Member</span> <span class="n">member</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">member</span> <span class="o">=</span> <span class="n">member</span><span class="o">;</span>
  <span class="o">}</span>
        
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isConnected</span><span class="o">(</span><span class="nc">ProviderType</span> <span class="n">type</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">return</span> <span class="nf">switch</span> <span class="o">(</span><span class="n">type</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">case</span> <span class="no">KAKAO</span> <span class="o">-&gt;</span> <span class="n">kakao</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">kakao</span><span class="o">.</span><span class="na">isConnected</span><span class="o">();</span>
      <span class="k">case</span> <span class="no">GOOGLE</span> <span class="o">-&gt;</span> <span class="n">google</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">google</span><span class="o">.</span><span class="na">isConnected</span><span class="o">();</span>
      <span class="k">case</span> <span class="no">NAVER</span> <span class="o">-&gt;</span> <span class="n">naver</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">naver</span><span class="o">.</span><span class="na">isConnected</span><span class="o">();</span>
      <span class="k">case</span> <span class="no">GITHUB</span> <span class="o">-&gt;</span> <span class="n">github</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">github</span><span class="o">.</span><span class="na">isConnected</span><span class="o">();</span>
      <span class="k">case</span> <span class="no">SELF</span> <span class="o">-&gt;</span> <span class="kc">false</span><span class="o">;</span>
      <span class="o">};</span>
  <span class="o">}</span>
        
  <span class="kd">public</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">ProviderType</span><span class="o">,</span> <span class="nc">OAuthProviderStatus</span><span class="o">&gt;</span> <span class="nf">getOAuthProviderStatuses</span><span class="o">()</span> <span class="o">{</span>
      <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">ProviderType</span><span class="o">,</span> <span class="nc">OAuthProviderStatus</span><span class="o">&gt;</span> <span class="n">statuses</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
      <span class="n">statuses</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">ProviderType</span><span class="o">.</span><span class="na">KAKAO</span><span class="o">,</span> <span class="nc">OAuthProviderStatus</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
          <span class="o">.</span><span class="na">createDate</span><span class="o">(</span><span class="n">kakao</span><span class="o">.</span><span class="na">getConnectedDate</span><span class="o">())</span>
          <span class="o">.</span><span class="na">email</span><span class="o">(</span><span class="n">kakao</span><span class="o">.</span><span class="na">getEmail</span><span class="o">())</span>
          <span class="o">.</span><span class="na">active</span><span class="o">(</span><span class="n">kakao</span><span class="o">.</span><span class="na">isConnected</span><span class="o">())</span>
          <span class="o">.</span><span class="na">build</span><span class="o">());</span>
        
      <span class="n">statuses</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">ProviderType</span><span class="o">.</span><span class="na">GOOGLE</span><span class="o">,</span> <span class="nc">OAuthProviderStatus</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
          <span class="o">.</span><span class="na">createDate</span><span class="o">(</span><span class="n">google</span><span class="o">.</span><span class="na">getConnectedDate</span><span class="o">())</span>
          <span class="o">.</span><span class="na">email</span><span class="o">(</span><span class="n">google</span><span class="o">.</span><span class="na">getEmail</span><span class="o">())</span>
          <span class="o">.</span><span class="na">active</span><span class="o">(</span><span class="n">google</span><span class="o">.</span><span class="na">isConnected</span><span class="o">())</span>
          <span class="o">.</span><span class="na">build</span><span class="o">());</span>
        
      <span class="n">statuses</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">ProviderType</span><span class="o">.</span><span class="na">GITHUB</span><span class="o">,</span> <span class="nc">OAuthProviderStatus</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
          <span class="o">.</span><span class="na">createDate</span><span class="o">(</span><span class="n">github</span><span class="o">.</span><span class="na">getConnectedDate</span><span class="o">())</span>
          <span class="o">.</span><span class="na">email</span><span class="o">(</span><span class="n">github</span><span class="o">.</span><span class="na">getEmail</span><span class="o">())</span>
          <span class="o">.</span><span class="na">active</span><span class="o">(</span><span class="n">github</span><span class="o">.</span><span class="na">isConnected</span><span class="o">())</span>
          <span class="o">.</span><span class="na">build</span><span class="o">());</span>
        
      <span class="n">statuses</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">ProviderType</span><span class="o">.</span><span class="na">NAVER</span><span class="o">,</span> <span class="nc">OAuthProviderStatus</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
          <span class="o">.</span><span class="na">createDate</span><span class="o">(</span><span class="n">naver</span><span class="o">.</span><span class="na">getConnectedDate</span><span class="o">())</span>
          <span class="o">.</span><span class="na">email</span><span class="o">(</span><span class="n">naver</span><span class="o">.</span><span class="na">getEmail</span><span class="o">())</span>
          <span class="o">.</span><span class="na">active</span><span class="o">(</span><span class="n">naver</span><span class="o">.</span><span class="na">isConnected</span><span class="o">())</span>
          <span class="o">.</span><span class="na">build</span><span class="o">());</span>
        
      <span class="k">return</span> <span class="n">statuses</span><span class="o">;</span>
  <span class="o">}</span>
        
  <span class="o">}</span>
        
</pre></table></code></div></div></div></details></ul></ul><p><br /></p><p><br /></p><p><br /></p><h3 id="-member"><span class="me-2">🔆 Member</span><a href="#-member" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><span class="class class-5">Member</span><ul><li>각<li> <details> <summary><code class="code">Code 보기</code></summary><div><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
</pre><td class="rouge-code"><pre>  <span class="kn">package</span> <span class="nn">com.msa.member.domain.member.member.entity</span><span class="o">;</span>
        
  <span class="kn">import</span> <span class="nn">com.fasterxml.jackson.annotation.JsonIgnore</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">com.msa.member.domain.member.auth.entity.OAuthProvider</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">com.msa.member.domain.member.auth.entity.SocialAccount</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">com.msa.member.domain.member.member.dto.MemberUpdateRequest</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">com.msa.member.domain.member.member.dto.OAuthProviderStatus</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">com.msa.member.domain.member.member.enums.Gender</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">com.msa.member.domain.member.member.enums.ProviderType</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">com.msa.member.domain.member.member.enums.MemberRole</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">com.msa.member.domain.member.member.enums.MemberStatus</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">com.msa.member.global.exceptions.ErrorCode</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">com.msa.member.global.exceptions.ServiceException</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">com.msa.member.global.jpa.BaseEntity</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">jakarta.persistence.*</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">lombok.*</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">lombok.experimental.SuperBuilder</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">org.hibernate.annotations.DynamicInsert</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">org.springframework.security.core.GrantedAuthority</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">org.springframework.security.core.authority.SimpleGrantedAuthority</span><span class="o">;</span>
        
  <span class="kn">import</span> <span class="nn">java.time.LocalDate</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
        
  <span class="kn">import</span> <span class="nn">static</span> <span class="n">jakarta</span><span class="o">.</span><span class="na">persistence</span><span class="o">.</span><span class="na">CascadeType</span><span class="o">.</span><span class="na">ALL</span><span class="o">;</span>
        
  <span class="nd">@Entity</span>
  <span class="nd">@Setter</span>
  <span class="nd">@Getter</span>
  <span class="nd">@AllArgsConstructor</span>
  <span class="nd">@NoArgsConstructor</span>
  <span class="nd">@SuperBuilder</span>
  <span class="nd">@DynamicInsert</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Member</span> <span class="kd">extends</span> <span class="nc">BaseEntity</span> <span class="o">{</span>
        
      <span class="nd">@Column</span><span class="o">(</span><span class="n">unique</span> <span class="o">=</span> <span class="kc">true</span><span class="o">,</span> <span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">,</span> <span class="n">length</span> <span class="o">=</span> <span class="mi">30</span><span class="o">)</span>
      <span class="kd">private</span> <span class="nc">String</span> <span class="n">email</span><span class="o">;</span>
        
      <span class="nd">@JsonIgnore</span>
      <span class="kd">private</span> <span class="nc">String</span> <span class="n">password</span><span class="o">;</span>
      <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">hasPassword</span><span class="o">()</span> <span class="o">{</span>
          <span class="k">return</span> <span class="n">password</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">password</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">();</span>
      <span class="o">}</span>
        
      <span class="nd">@Column</span><span class="o">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
      <span class="kd">private</span> <span class="nc">String</span> <span class="n">nickname</span><span class="o">;</span>  <span class="c1">// 닉네임</span>
        
      <span class="kd">private</span> <span class="nc">LocalDate</span> <span class="n">birthDate</span><span class="o">;</span>
        
      <span class="kd">private</span> <span class="nc">String</span> <span class="n">address</span><span class="o">;</span>  <span class="c1">// 주소</span>
        
      <span class="nd">@Enumerated</span><span class="o">(</span><span class="nc">EnumType</span><span class="o">.</span><span class="na">STRING</span><span class="o">)</span>
      <span class="nd">@Column</span><span class="o">(</span><span class="n">length</span> <span class="o">=</span> <span class="mi">1</span><span class="o">)</span>
      <span class="kd">private</span> <span class="nc">Gender</span> <span class="n">gender</span><span class="o">;</span>  <span class="c1">// 성별</span>
        
      <span class="nd">@Column</span><span class="o">(</span><span class="n">length</span> <span class="o">=</span> <span class="mi">20</span><span class="o">)</span>
      <span class="kd">private</span> <span class="nc">String</span> <span class="n">phoneNumber</span><span class="o">;</span>  <span class="c1">// 전화번호</span>
        
      <span class="nd">@Column</span><span class="o">(</span><span class="n">columnDefinition</span> <span class="o">=</span> <span class="s">"VARCHAR(255) DEFAULT 'default.png'"</span><span class="o">)</span>
      <span class="kd">private</span> <span class="nc">String</span> <span class="n">profileImageUrl</span> <span class="o">=</span> <span class="s">"default.png"</span><span class="o">;</span>  <span class="c1">// 프로필 사진 경로</span>
        
      <span class="nd">@Column</span><span class="o">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">,</span> <span class="n">columnDefinition</span> <span class="o">=</span> <span class="s">"BOOLEAN DEFAULT TRUE"</span><span class="o">)</span>
      <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">marketingAgree</span><span class="o">;</span>  <span class="c1">// 마케팅 수신여부</span>
        
      <span class="nd">@Enumerated</span><span class="o">(</span><span class="nc">EnumType</span><span class="o">.</span><span class="na">STRING</span><span class="o">)</span>
      <span class="nd">@Column</span><span class="o">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">,</span> <span class="n">columnDefinition</span> <span class="o">=</span> <span class="s">"ENUM('ACTIVE', 'INACTIVE', 'BANNED', 'WITHDRAWN') DEFAULT 'ACTIVE'"</span><span class="o">)</span>
      <span class="kd">private</span> <span class="nc">MemberStatus</span> <span class="n">status</span><span class="o">;</span>  <span class="c1">// 회원 상태</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">deactivate</span><span class="o">()</span> <span class="o">{</span>
          <span class="n">status</span> <span class="o">=</span> <span class="nc">MemberStatus</span><span class="o">.</span><span class="na">WITHDRAWN</span><span class="o">;</span>
      <span class="o">}</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">restore</span><span class="o">()</span> <span class="o">{</span>
          <span class="n">status</span> <span class="o">=</span> <span class="nc">MemberStatus</span><span class="o">.</span><span class="na">ACTIVE</span><span class="o">;</span>
      <span class="o">}</span>
        
      <span class="nd">@Enumerated</span><span class="o">(</span><span class="nc">EnumType</span><span class="o">.</span><span class="na">STRING</span><span class="o">)</span>
      <span class="nd">@Column</span><span class="o">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">,</span> <span class="n">columnDefinition</span> <span class="o">=</span> <span class="s">"ENUM('ROLE_USER', 'ROLE_ADMIN') DEFAULT 'ROLE_USER'"</span><span class="o">)</span>
      <span class="kd">private</span> <span class="nc">MemberRole</span> <span class="n">role</span> <span class="o">=</span> <span class="nc">MemberRole</span><span class="o">.</span><span class="na">ROLE_USER</span><span class="o">;</span>  <span class="c1">// 권한 (관리자, 사용자)</span>
      <span class="kd">public</span> <span class="nc">Collection</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="nc">GrantedAuthority</span><span class="o">&gt;</span> <span class="nf">getAuthorities</span><span class="o">()</span> <span class="o">{</span>
          <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">role</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
              <span class="k">return</span> <span class="nc">Collections</span><span class="o">.</span><span class="na">singletonList</span><span class="o">(</span><span class="k">new</span> <span class="nc">SimpleGrantedAuthority</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">role</span><span class="o">.</span><span class="na">name</span><span class="o">()));</span>
          <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
              <span class="k">return</span> <span class="nc">Collections</span><span class="o">.</span><span class="na">singletonList</span><span class="o">(</span><span class="k">new</span> <span class="nc">SimpleGrantedAuthority</span><span class="o">(</span><span class="nc">MemberRole</span><span class="o">.</span><span class="na">ROLE_USER</span><span class="o">.</span><span class="na">name</span><span class="o">()));</span>
          <span class="o">}</span>
      <span class="o">}</span>
        
      <span class="nd">@JsonIgnore</span>
      <span class="nd">@Column</span><span class="o">(</span><span class="n">unique</span> <span class="o">=</span> <span class="kc">true</span><span class="o">,</span> <span class="n">length</span> <span class="o">=</span> <span class="mi">50</span><span class="o">)</span>
      <span class="kd">private</span> <span class="nc">String</span> <span class="n">apiKey</span><span class="o">;</span>
        
      <span class="nd">@Enumerated</span><span class="o">(</span><span class="nc">EnumType</span><span class="o">.</span><span class="na">STRING</span><span class="o">)</span>
      <span class="nd">@Column</span><span class="o">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">,</span> <span class="n">columnDefinition</span> <span class="o">=</span> <span class="s">"VARCHAR(50) DEFAULT 'SELF'"</span><span class="o">)</span>
      <span class="kd">private</span> <span class="nc">ProviderType</span> <span class="n">loginType</span> <span class="o">=</span> <span class="nc">ProviderType</span><span class="o">.</span><span class="na">SELF</span><span class="o">;</span>  <span class="c1">// 현재 로그인 방식</span>
        
      <span class="c1">// 1대1 관계 설정</span>
      <span class="nd">@JsonIgnore</span>
      <span class="nd">@OneToOne</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"member"</span><span class="o">,</span> <span class="n">cascade</span> <span class="o">=</span> <span class="no">ALL</span><span class="o">,</span> <span class="n">orphanRemoval</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
      <span class="kd">private</span> <span class="nc">OAuthProvider</span> <span class="n">oauthProvider</span><span class="o">;</span>
        
      <span class="kd">public</span> <span class="nc">OAuthProvider</span> <span class="nf">getOAuthProviderOrCreate</span><span class="o">()</span> <span class="o">{</span>
          <span class="k">if</span> <span class="o">(</span><span class="n">oauthProvider</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
              <span class="n">oauthProvider</span> <span class="o">=</span> <span class="nc">OAuthProvider</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
                  <span class="o">.</span><span class="na">member</span><span class="o">(</span><span class="k">this</span><span class="o">)</span>
                  <span class="o">.</span><span class="na">build</span><span class="o">();</span>
          <span class="o">}</span>
          <span class="k">return</span> <span class="n">oauthProvider</span><span class="o">;</span>
      <span class="o">}</span>
        
      <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">hasOAuthProvider</span><span class="o">(</span><span class="nc">ProviderType</span> <span class="n">type</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">return</span> <span class="n">oauthProvider</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">oauthProvider</span><span class="o">.</span><span class="na">isConnected</span><span class="o">(</span><span class="n">type</span><span class="o">);</span>
      <span class="o">}</span>
        
      <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getConnectedOAuthCount</span><span class="o">()</span> <span class="o">{</span>
          <span class="k">if</span> <span class="o">(</span><span class="n">oauthProvider</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="k">return</span> <span class="mi">0</span><span class="o">;</span>
        
          <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
          <span class="k">if</span> <span class="o">(</span><span class="n">oauthProvider</span><span class="o">.</span><span class="na">isConnected</span><span class="o">(</span><span class="nc">ProviderType</span><span class="o">.</span><span class="na">KAKAO</span><span class="o">))</span> <span class="n">count</span><span class="o">++;</span>
          <span class="k">if</span> <span class="o">(</span><span class="n">oauthProvider</span><span class="o">.</span><span class="na">isConnected</span><span class="o">(</span><span class="nc">ProviderType</span><span class="o">.</span><span class="na">GOOGLE</span><span class="o">))</span> <span class="n">count</span><span class="o">++;</span>
          <span class="k">if</span> <span class="o">(</span><span class="n">oauthProvider</span><span class="o">.</span><span class="na">isConnected</span><span class="o">(</span><span class="nc">ProviderType</span><span class="o">.</span><span class="na">NAVER</span><span class="o">))</span> <span class="n">count</span><span class="o">++;</span>
          <span class="k">if</span> <span class="o">(</span><span class="n">oauthProvider</span><span class="o">.</span><span class="na">isConnected</span><span class="o">(</span><span class="nc">ProviderType</span><span class="o">.</span><span class="na">GITHUB</span><span class="o">))</span> <span class="n">count</span><span class="o">++;</span>
          <span class="k">return</span> <span class="n">count</span><span class="o">;</span>
      <span class="o">}</span>
        
      <span class="kd">public</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">ProviderType</span><span class="o">,</span> <span class="nc">OAuthProviderStatus</span><span class="o">&gt;</span> <span class="nf">getOAuthProviderStatuses</span><span class="o">()</span> <span class="o">{</span>
          <span class="k">if</span> <span class="o">(</span><span class="n">oauthProvider</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
              <span class="k">return</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
          <span class="o">}</span>
          <span class="k">return</span> <span class="n">oauthProvider</span><span class="o">.</span><span class="na">getOAuthProviderStatuses</span><span class="o">();</span>
      <span class="o">}</span>
        
      <span class="nd">@JsonIgnore</span>
      <span class="nd">@OneToOne</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"member"</span><span class="o">,</span> <span class="n">cascade</span> <span class="o">=</span> <span class="no">ALL</span><span class="o">,</span> <span class="n">orphanRemoval</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
      <span class="kd">private</span> <span class="nc">SocialAccount</span> <span class="n">socialAccount</span><span class="o">;</span>
        
      <span class="kd">public</span> <span class="nc">SocialAccount</span> <span class="nf">getSocialAccountOrCreate</span><span class="o">()</span> <span class="o">{</span>
          <span class="k">if</span> <span class="o">(</span><span class="n">socialAccount</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
              <span class="n">socialAccount</span> <span class="o">=</span> <span class="nc">SocialAccount</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
                  <span class="o">.</span><span class="na">member</span><span class="o">(</span><span class="k">this</span><span class="o">)</span>
                  <span class="o">.</span><span class="na">build</span><span class="o">();</span>
          <span class="o">}</span>
          <span class="k">return</span> <span class="n">socialAccount</span><span class="o">;</span>
      <span class="o">}</span>
        
      <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">hasSocialAccount</span><span class="o">(</span><span class="nc">ProviderType</span> <span class="n">provider</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">return</span> <span class="n">socialAccount</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">socialAccount</span><span class="o">.</span><span class="na">hasSocialAccount</span><span class="o">(</span><span class="n">provider</span><span class="o">);</span>
      <span class="o">}</span>
        
      <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getConnectedSocialCount</span><span class="o">()</span> <span class="o">{</span>
          <span class="k">if</span> <span class="o">(</span><span class="n">socialAccount</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="k">return</span> <span class="mi">0</span><span class="o">;</span>
        
          <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
          <span class="k">if</span> <span class="o">(</span><span class="n">socialAccount</span><span class="o">.</span><span class="na">isKakaoActive</span><span class="o">())</span> <span class="n">count</span><span class="o">++;</span>
          <span class="k">if</span> <span class="o">(</span><span class="n">socialAccount</span><span class="o">.</span><span class="na">isGoogleActive</span><span class="o">())</span> <span class="n">count</span><span class="o">++;</span>
          <span class="k">if</span> <span class="o">(</span><span class="n">socialAccount</span><span class="o">.</span><span class="na">isNaverActive</span><span class="o">())</span> <span class="n">count</span><span class="o">++;</span>
          <span class="k">if</span> <span class="o">(</span><span class="n">socialAccount</span><span class="o">.</span><span class="na">isGithubActive</span><span class="o">())</span> <span class="n">count</span><span class="o">++;</span>
          <span class="k">return</span> <span class="n">count</span><span class="o">;</span>
      <span class="o">}</span>
        
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">disconnectSocialAccount</span><span class="o">(</span><span class="nc">ProviderType</span> <span class="n">provider</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">if</span> <span class="o">(</span><span class="n">socialAccount</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
              <span class="k">throw</span> <span class="k">new</span> <span class="nf">ServiceException</span><span class="o">(</span><span class="nc">ErrorCode</span><span class="o">.</span><span class="na">NOT_CONNECTED_SOCIAL_ACCOUNT</span><span class="o">);</span>
          <span class="o">}</span>
        
          <span class="k">switch</span> <span class="o">(</span><span class="n">provider</span><span class="o">)</span> <span class="o">{</span>
              <span class="k">case</span> <span class="nc">ProviderType</span><span class="o">.</span><span class="na">KAKAO</span> <span class="o">-&gt;</span> <span class="n">socialAccount</span><span class="o">.</span><span class="na">disconnectKakao</span><span class="o">();</span>
              <span class="k">case</span> <span class="nc">ProviderType</span><span class="o">.</span><span class="na">GOOGLE</span> <span class="o">-&gt;</span> <span class="n">socialAccount</span><span class="o">.</span><span class="na">disconnectGoogle</span><span class="o">();</span>
              <span class="k">case</span> <span class="nc">ProviderType</span><span class="o">.</span><span class="na">GITHUB</span> <span class="o">-&gt;</span> <span class="n">socialAccount</span><span class="o">.</span><span class="na">disconnectGithub</span><span class="o">();</span>
              <span class="k">case</span> <span class="nc">ProviderType</span><span class="o">.</span><span class="na">NAVER</span> <span class="o">-&gt;</span> <span class="n">socialAccount</span><span class="o">.</span><span class="na">disconnectNaver</span><span class="o">();</span>
              <span class="k">default</span> <span class="o">-&gt;</span> <span class="k">throw</span> <span class="k">new</span> <span class="nc">ServiceException</span><span class="o">(</span><span class="nc">ErrorCode</span><span class="o">.</span><span class="na">DISCONNECT_FAIL</span><span class="o">);</span>
          <span class="o">}</span>
      <span class="o">}</span>
        
      <span class="kd">public</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">ProviderType</span><span class="o">,</span> <span class="nc">OAuthProviderStatus</span><span class="o">&gt;</span> <span class="nf">getSocialAccountStatuses</span><span class="o">()</span> <span class="o">{</span>
          <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">ProviderType</span><span class="o">,</span> <span class="nc">OAuthProviderStatus</span><span class="o">&gt;</span> <span class="n">statuses</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
          <span class="k">if</span> <span class="o">(</span><span class="n">socialAccount</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
              <span class="c1">// Kakao</span>
              <span class="n">statuses</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">ProviderType</span><span class="o">.</span><span class="na">KAKAO</span><span class="o">,</span> <span class="nc">OAuthProviderStatus</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
                  <span class="o">.</span><span class="na">createDate</span><span class="o">(</span><span class="n">socialAccount</span><span class="o">.</span><span class="na">getKakaoCreateDate</span><span class="o">())</span>
                  <span class="o">.</span><span class="na">email</span><span class="o">(</span><span class="n">socialAccount</span><span class="o">.</span><span class="na">getKakaoEmail</span><span class="o">())</span>
                  <span class="o">.</span><span class="na">active</span><span class="o">(</span><span class="n">socialAccount</span><span class="o">.</span><span class="na">isKakaoActive</span><span class="o">())</span>
                  <span class="o">.</span><span class="na">build</span><span class="o">());</span>
        
              <span class="c1">// Google</span>
              <span class="n">statuses</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">ProviderType</span><span class="o">.</span><span class="na">GOOGLE</span><span class="o">,</span> <span class="nc">OAuthProviderStatus</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
                  <span class="o">.</span><span class="na">createDate</span><span class="o">(</span><span class="n">socialAccount</span><span class="o">.</span><span class="na">getGoogleCreateDate</span><span class="o">())</span>
                  <span class="o">.</span><span class="na">email</span><span class="o">(</span><span class="n">socialAccount</span><span class="o">.</span><span class="na">getGoogleEmail</span><span class="o">())</span>
                  <span class="o">.</span><span class="na">active</span><span class="o">(</span><span class="n">socialAccount</span><span class="o">.</span><span class="na">isGoogleActive</span><span class="o">())</span>
                  <span class="o">.</span><span class="na">build</span><span class="o">());</span>
        
              <span class="c1">// Github</span>
              <span class="n">statuses</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">ProviderType</span><span class="o">.</span><span class="na">GITHUB</span><span class="o">,</span> <span class="nc">OAuthProviderStatus</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
                  <span class="o">.</span><span class="na">createDate</span><span class="o">(</span><span class="n">socialAccount</span><span class="o">.</span><span class="na">getGithubCreateDate</span><span class="o">())</span>
                  <span class="o">.</span><span class="na">email</span><span class="o">(</span><span class="n">socialAccount</span><span class="o">.</span><span class="na">getGithubEmail</span><span class="o">())</span>
                  <span class="o">.</span><span class="na">active</span><span class="o">(</span><span class="n">socialAccount</span><span class="o">.</span><span class="na">isGithubActive</span><span class="o">())</span>
                  <span class="o">.</span><span class="na">build</span><span class="o">());</span>
        
              <span class="c1">// Naver</span>
              <span class="n">statuses</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">ProviderType</span><span class="o">.</span><span class="na">NAVER</span><span class="o">,</span> <span class="nc">OAuthProviderStatus</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
                  <span class="o">.</span><span class="na">createDate</span><span class="o">(</span><span class="n">socialAccount</span><span class="o">.</span><span class="na">getNaverCreateDate</span><span class="o">())</span>
                  <span class="o">.</span><span class="na">email</span><span class="o">(</span><span class="n">socialAccount</span><span class="o">.</span><span class="na">getNaverEmail</span><span class="o">())</span>
                  <span class="o">.</span><span class="na">active</span><span class="o">(</span><span class="n">socialAccount</span><span class="o">.</span><span class="na">isNaverActive</span><span class="o">())</span>
                  <span class="o">.</span><span class="na">build</span><span class="o">());</span>
          <span class="o">}</span>
        
          <span class="k">return</span> <span class="n">statuses</span><span class="o">;</span>
      <span class="o">}</span>
        
      <span class="c1">// 1:N 관계 설정</span>
        
      <span class="c1">// Entity 메서드</span>
      <span class="kd">public</span> <span class="nf">Member</span><span class="o">(</span><span class="nc">String</span> <span class="n">email</span><span class="o">,</span> <span class="nc">String</span> <span class="n">nickname</span><span class="o">,</span> <span class="nc">String</span> <span class="n">profileImageUrl</span><span class="o">,</span> <span class="nc">MemberRole</span> <span class="n">role</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">this</span><span class="o">.</span><span class="na">email</span> <span class="o">=</span> <span class="n">email</span><span class="o">;</span>
          <span class="k">this</span><span class="o">.</span><span class="na">nickname</span> <span class="o">=</span> <span class="n">nickname</span><span class="o">;</span>
          <span class="k">this</span><span class="o">.</span><span class="na">profileImageUrl</span> <span class="o">=</span> <span class="n">profileImageUrl</span><span class="o">;</span>
          <span class="k">this</span><span class="o">.</span><span class="na">role</span> <span class="o">=</span> <span class="n">role</span><span class="o">;</span>
      <span class="o">}</span>
        
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">updateInfo</span><span class="o">(</span><span class="nc">MemberUpdateRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">gender</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getGender</span><span class="o">();</span>
          <span class="n">nickname</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getNickname</span><span class="o">();</span>
          <span class="n">marketingAgree</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">isMkAlarm</span><span class="o">();</span>
          <span class="n">birthDate</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getBirthday</span><span class="o">();</span>
          <span class="n">address</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getLocation</span><span class="o">();</span>
          <span class="n">phoneNumber</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getPhoneNumber</span><span class="o">();</span>
      <span class="o">}</span>
  <span class="o">}</span>
        
</pre></table></code></div></div></div></details><li>s</ul></ul><p><br /></p><p><br /></p><p><br /></p><p><br /></p><h2 id="-strategy-layer"><span class="me-2">👉 Strategy Layer</span><a href="#-strategy-layer" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="-oauthproviderstrategy"><span class="me-2">🔆 OAuthProviderStrategy</span><a href="#-oauthproviderstrategy" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><span class="class class-1">OAuthProviderStrategy</span><ul><li>각각의 소셜 로그인 제공자별 동작을 정의하는 인터페이스<li>ProviderType을 반환<li>해당 ProviderType과 ProviderId에 해당하는 회원 찾기<li><p>OAuthProvider의 각각의 Provider의 연결/해제를 동작??</p><details> <summary><code class="code">Code 보기</code></summary><div><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>  <span class="kn">package</span> <span class="nn">com.msa.member.domain.member.auth.strategy</span><span class="o">;</span>
        
  <span class="kn">import</span> <span class="nn">com.msa.member.domain.member.member.entity.Member</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">com.msa.member.domain.member.member.enums.ProviderType</span><span class="o">;</span>
        
  <span class="kd">public</span> <span class="kd">interface</span> <span class="nc">OAuthProviderStrategy</span> <span class="o">{</span>
  <span class="nc">ProviderType</span> <span class="nf">getProviderType</span><span class="o">();</span>
  <span class="nc">Member</span> <span class="nf">findByProviderId</span><span class="o">(</span><span class="nc">String</span> <span class="n">providerId</span><span class="o">);</span>
  <span class="kt">void</span> <span class="nf">connect</span><span class="o">(</span><span class="nc">Member</span> <span class="n">member</span><span class="o">,</span> <span class="nc">String</span> <span class="n">providerId</span><span class="o">,</span> <span class="nc">String</span> <span class="n">email</span><span class="o">);</span>
  <span class="kt">void</span> <span class="nf">disconnect</span><span class="o">(</span><span class="nc">Member</span> <span class="n">member</span><span class="o">);</span>
  <span class="o">}</span>
</pre></table></code></div></div></div></details></ul></ul><p><br /></p><p><br /></p><p><br /></p><h3 id="-kakaoproviderstrategy-googleproviderstrategy-등"><span class="me-2">🔆 KakaoProviderStrategy, GoogleProviderStrategy 등</span><a href="#-kakaoproviderstrategy-googleproviderstrategy-등" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><span class="class class-2">KakaoProviderStrategy</span><ul><li>인터페이스를 구현하여 실질적인 연결/해제를 구현한다.<li><p>MemberRepository를 사용하여 해당하는 Member 엔티티를 가져온다.</p><details> <summary><code class="code">Code 보기</code></summary><div><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre><td class="rouge-code"><pre>  <span class="kn">package</span> <span class="nn">com.msa.member.domain.member.auth.strategy</span><span class="o">;</span>
        
  <span class="kn">import</span> <span class="nn">com.msa.member.domain.member.auth.entity.OAuthProvider</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">com.msa.member.domain.member.member.entity.Member</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">com.msa.member.domain.member.member.enums.ProviderType</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">com.msa.member.domain.member.member.repository.MemberRepository</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">lombok.RequiredArgsConstructor</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="o">;</span>
        
  <span class="nd">@Component</span>
  <span class="nd">@RequiredArgsConstructor</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">KakaoProviderStrategy</span> <span class="kd">implements</span> <span class="nc">OAuthProviderStrategy</span> <span class="o">{</span>
        
  <span class="kd">private</span> <span class="kd">final</span> <span class="nc">MemberRepository</span> <span class="n">memberRepository</span><span class="o">;</span>
        
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">ProviderType</span> <span class="nf">getProviderType</span><span class="o">()</span> <span class="o">{</span>
      <span class="k">return</span> <span class="nc">ProviderType</span><span class="o">.</span><span class="na">KAKAO</span><span class="o">;</span>
  <span class="o">}</span>
        
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">Member</span> <span class="nf">findByProviderId</span><span class="o">(</span><span class="nc">String</span> <span class="n">providerId</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">return</span> <span class="n">memberRepository</span><span class="o">.</span><span class="na">findByKakaoProviderId</span><span class="o">(</span><span class="n">providerId</span><span class="o">).</span><span class="na">orElse</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
  <span class="o">}</span>
        
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">connect</span><span class="o">(</span><span class="nc">Member</span> <span class="n">member</span><span class="o">,</span> <span class="nc">String</span> <span class="n">providerId</span><span class="o">,</span> <span class="nc">String</span> <span class="n">email</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">OAuthProvider</span> <span class="n">oAuthProvider</span> <span class="o">=</span> <span class="n">member</span><span class="o">.</span><span class="na">getOAuthProviderOrCreate</span><span class="o">();</span>
      <span class="n">oAuthProvider</span><span class="o">.</span><span class="na">addKakaoProvider</span><span class="o">(</span><span class="n">providerId</span><span class="o">,</span> <span class="n">email</span><span class="o">);</span>
  <span class="o">}</span>
        
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">disconnect</span><span class="o">(</span><span class="nc">Member</span> <span class="n">member</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">OAuthProvider</span> <span class="n">oAuthProvider</span> <span class="o">=</span> <span class="n">member</span><span class="o">.</span><span class="na">getOAuthProviderOrCreate</span><span class="o">();</span>
      <span class="n">oAuthProvider</span><span class="o">.</span><span class="na">removeKakaoProvider</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="o">}</span>
        
</pre></table></code></div></div></div></details></ul></ul><p><br /></p><p><br /></p><p><br /></p><p><br /></p><h2 id="-service-layer"><span class="me-2">👉 Service Layer</span><a href="#-service-layer" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="-oauthservice"><span class="me-2">🔆 OAuthService</span><a href="#-oauthservice" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><span class="class class-1">OAuthService</span><ul><li>Strategy 패턴을 활용한 OAuth 처리 서비스<li><p>ProviderType에 따라 적절한 Strategy를 선택하여 처리한다.</p><details> <summary><code class="code">Code 보기</code></summary><div><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
</pre><td class="rouge-code"><pre>  <span class="kn">package</span> <span class="nn">com.msa.member.domain.member.auth.service</span><span class="o">;</span>
        
  <span class="kn">import</span> <span class="nn">com.msa.member.domain.member.auth.entity.SocialAccount</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">com.msa.member.domain.member.auth.strategy.*</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">com.msa.member.domain.member.member.entity.Member</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">com.msa.member.domain.member.member.enums.ProviderType</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">com.msa.member.global.exceptions.ErrorCode</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">com.msa.member.global.exceptions.ServiceException</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">org.springframework.transaction.annotation.Transactional</span><span class="o">;</span>
        
  <span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">java.util.stream.Collectors</span><span class="o">;</span>
        
  <span class="nd">@Service</span>
  <span class="nd">@Transactional</span><span class="o">(</span><span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">OAuthService</span> <span class="o">{</span>
        
  <span class="kd">private</span> <span class="kd">final</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">ProviderType</span><span class="o">,</span> <span class="nc">OAuthProviderStrategy</span><span class="o">&gt;</span> <span class="n">strategies</span><span class="o">;</span>
        
  <span class="kd">public</span> <span class="nf">OAuthService</span><span class="o">(</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">OAuthProviderStrategy</span><span class="o">&gt;</span> <span class="n">providerStrategies</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">strategies</span> <span class="o">=</span> <span class="n">providerStrategies</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
          <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">toMap</span><span class="o">(</span>
              <span class="nl">OAuthProviderStrategy:</span><span class="o">:</span><span class="n">getProviderType</span><span class="o">,</span>
              <span class="n">strategy</span> <span class="o">-&gt;</span> <span class="n">strategy</span>
          <span class="o">));</span>
  <span class="o">}</span>
        
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">connectProvider</span><span class="o">(</span><span class="nc">Member</span> <span class="n">member</span><span class="o">,</span> <span class="nc">ProviderType</span> <span class="n">type</span><span class="o">,</span> <span class="nc">String</span> <span class="n">providerId</span><span class="o">,</span> <span class="nc">String</span> <span class="n">email</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">OAuthProviderStrategy</span> <span class="n">strategy</span> <span class="o">=</span> <span class="n">strategies</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">type</span><span class="o">);</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">strategy</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nf">ServiceException</span><span class="o">(</span><span class="nc">ErrorCode</span><span class="o">.</span><span class="na">INVALID_LOGIN_TYPE</span><span class="o">);</span>
      <span class="o">}</span>
      <span class="n">strategy</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="n">member</span><span class="o">,</span> <span class="n">providerId</span><span class="o">,</span> <span class="n">email</span><span class="o">);</span>
  <span class="o">}</span>
        
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">disconnectProvider</span><span class="o">(</span><span class="nc">Member</span> <span class="n">member</span><span class="o">,</span> <span class="nc">ProviderType</span> <span class="n">type</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">OAuthProviderStrategy</span> <span class="n">strategy</span> <span class="o">=</span> <span class="n">strategies</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">type</span><span class="o">);</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">strategy</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nf">ServiceException</span><span class="o">(</span><span class="nc">ErrorCode</span><span class="o">.</span><span class="na">INVALID_LOGIN_TYPE</span><span class="o">);</span>
      <span class="o">}</span>
      <span class="n">strategy</span><span class="o">.</span><span class="na">disconnect</span><span class="o">(</span><span class="n">member</span><span class="o">);</span>
  <span class="o">}</span>
        
  <span class="kd">public</span> <span class="nc">Member</span> <span class="nf">findByProviderId</span><span class="o">(</span><span class="nc">ProviderType</span> <span class="n">type</span><span class="o">,</span> <span class="nc">String</span> <span class="n">providerId</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">OAuthProviderStrategy</span> <span class="n">strategy</span> <span class="o">=</span> <span class="n">strategies</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">type</span><span class="o">);</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">strategy</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nf">ServiceException</span><span class="o">(</span><span class="nc">ErrorCode</span><span class="o">.</span><span class="na">INVALID_LOGIN_TYPE</span><span class="o">);</span>
      <span class="o">}</span>
      <span class="k">return</span> <span class="n">strategy</span><span class="o">.</span><span class="na">findByProviderId</span><span class="o">(</span><span class="n">providerId</span><span class="o">);</span>
  <span class="o">}</span>
        
  <span class="o">}</span>
        
</pre></table></code></div></div></div></details><li>s</ul></ul><p><br /></p><p><br /></p><p><br /></p><h3 id="-authservice"><span class="me-2">🔆 AuthService</span><a href="#-authservice" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><span class="class class-2">AuthService</span><ul><li>OAuthService의 상위 서비스로 인증 관련 로직을 처리한다.<li><p>회원가입, 소셜 로그인, Token 생성 등</p><details> <summary><code class="code">Code 보기</code></summary><div><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
</pre><td class="rouge-code"><pre>  <span class="kn">package</span> <span class="nn">com.msa.member.domain.member.auth.service</span><span class="o">;</span>
        
  <span class="kn">import</span> <span class="nn">com.msa.member.domain.member.auth.dto.EmailInfo</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">com.msa.member.domain.member.auth.dto.FindEmailsResponse</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">com.msa.member.domain.member.auth.entity.SocialAccount</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">com.msa.member.domain.member.member.entity.Member</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">com.msa.member.domain.member.member.enums.ProviderType</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">com.msa.member.domain.member.member.enums.MemberRole</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">com.msa.member.domain.member.member.enums.MemberStatus</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">com.msa.member.domain.member.member.repository.MemberRepository</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">com.msa.member.global.exceptions.ErrorCode</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">com.msa.member.global.exceptions.ServiceException</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">com.msa.member.standard.util.Ut</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">lombok.RequiredArgsConstructor</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">org.springframework.security.crypto.password.PasswordEncoder</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">org.springframework.transaction.annotation.Transactional</span><span class="o">;</span>
        
  <span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">java.util.Optional</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">java.util.UUID</span><span class="o">;</span>
        
  <span class="nd">@Transactional</span><span class="o">(</span><span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
  <span class="nd">@Service</span>
  <span class="nd">@RequiredArgsConstructor</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">AuthService</span> <span class="o">{</span>
        
      <span class="kd">private</span> <span class="kd">final</span> <span class="nc">AuthTokenService</span> <span class="n">authTokenService</span><span class="o">;</span>
      <span class="kd">private</span> <span class="kd">final</span> <span class="nc">OAuthService</span> <span class="n">oAuthService</span><span class="o">;</span>
      <span class="kd">private</span> <span class="kd">final</span> <span class="nc">PasswordEncoder</span> <span class="n">passwordEncoder</span><span class="o">;</span>
      <span class="kd">private</span> <span class="kd">final</span> <span class="nc">MemberRepository</span> <span class="n">memberRepository</span><span class="o">;</span>
        
      <span class="nd">@Transactional</span>
      <span class="kd">public</span> <span class="nc">Member</span> <span class="nf">signup</span><span class="o">(</span>
          <span class="nc">String</span> <span class="n">email</span><span class="o">,</span> <span class="nc">String</span> <span class="n">password</span><span class="o">,</span> <span class="nc">String</span> <span class="n">nickname</span><span class="o">,</span>
          <span class="nc">ProviderType</span> <span class="n">loginType</span><span class="o">,</span> <span class="nc">String</span> <span class="n">providerId</span><span class="o">,</span> <span class="nc">String</span> <span class="n">providerEmail</span><span class="o">,</span> <span class="nc">String</span> <span class="n">profileImageUrl</span>
      <span class="o">)</span> <span class="o">{</span>
          <span class="n">_validateEmailAndPassword</span><span class="o">(</span><span class="n">email</span><span class="o">,</span> <span class="n">password</span><span class="o">,</span> <span class="n">loginType</span><span class="o">);</span>
        
          <span class="nc">Optional</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="n">existingMember</span> <span class="o">=</span> <span class="n">memberRepository</span><span class="o">.</span><span class="na">findByEmail</span><span class="o">(</span><span class="n">email</span><span class="o">);</span>
          <span class="k">if</span> <span class="o">(</span><span class="n">existingMember</span><span class="o">.</span><span class="na">isPresent</span><span class="o">())</span> <span class="o">{</span>
              <span class="k">throw</span> <span class="k">new</span> <span class="nf">ServiceException</span><span class="o">(</span><span class="nc">ErrorCode</span><span class="o">.</span><span class="na">DUPLICATE_EMAIL</span><span class="o">);</span>
          <span class="o">}</span>
        
          <span class="nc">Member</span> <span class="n">member</span> <span class="o">=</span> <span class="nc">Member</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
              <span class="o">.</span><span class="na">email</span><span class="o">(</span><span class="n">email</span><span class="o">)</span>
              <span class="o">.</span><span class="na">password</span><span class="o">(</span>
                  <span class="n">loginType</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="nc">ProviderType</span><span class="o">.</span><span class="na">SELF</span><span class="o">)</span> <span class="o">?</span> <span class="n">passwordEncoder</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="n">password</span><span class="o">)</span> <span class="o">:</span> <span class="kc">null</span>
              <span class="o">)</span>
              <span class="o">.</span><span class="na">nickname</span><span class="o">(</span><span class="n">nickname</span><span class="o">)</span>
              <span class="o">.</span><span class="na">loginType</span><span class="o">(</span><span class="n">loginType</span><span class="o">)</span>
              <span class="o">.</span><span class="na">profileImageUrl</span><span class="o">(</span><span class="n">profileImageUrl</span><span class="o">)</span>
              <span class="o">.</span><span class="na">apiKey</span><span class="o">(</span><span class="no">UUID</span><span class="o">.</span><span class="na">randomUUID</span><span class="o">().</span><span class="na">toString</span><span class="o">())</span>
              <span class="o">.</span><span class="na">role</span><span class="o">(</span><span class="nc">MemberRole</span><span class="o">.</span><span class="na">ROLE_USER</span><span class="o">)</span>
              <span class="o">.</span><span class="na">status</span><span class="o">(</span><span class="nc">MemberStatus</span><span class="o">.</span><span class="na">ACTIVE</span><span class="o">)</span>
              <span class="o">.</span><span class="na">build</span><span class="o">();</span>
        
          <span class="k">if</span> <span class="o">(</span><span class="n">providerId</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
              <span class="n">oAuthService</span><span class="o">.</span><span class="na">connectProvider</span><span class="o">(</span><span class="n">member</span><span class="o">,</span> <span class="n">loginType</span><span class="o">,</span> <span class="n">providerId</span><span class="o">,</span> <span class="n">providerEmail</span><span class="o">);</span>
          <span class="o">}</span>
        
          <span class="k">return</span> <span class="n">memberRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">member</span><span class="o">);</span>
      <span class="o">}</span>
        
  <span class="c1">//    @Transactional</span>
  <span class="c1">//    public Member signup(</span>
  <span class="c1">//            String email, String password, String nickname,</span>
  <span class="c1">//            ProviderType loginType, String providerId, String providerEmail, String profileImageUrl</span>
  <span class="c1">//        ) {</span>
  <span class="c1">//        _validateEmailAndPassword(email, password, loginType);</span>
  <span class="c1">//</span>
  <span class="c1">//        Optional&lt;Member&gt; existingMember = memberRepository.findByEmail(email);</span>
  <span class="c1">//        if (existingMember.isPresent()) {</span>
  <span class="c1">//            throw new ServiceException(ErrorCode.DUPLICATE_EMAIL);</span>
  <span class="c1">//        }</span>
  <span class="c1">//</span>
  <span class="c1">//        Member member = Member.builder()</span>
  <span class="c1">//                .email(email)</span>
  <span class="c1">//                .password(</span>
  <span class="c1">//                    loginType.equals(ProviderType.SELF) ? passwordEncoder.encode(password) : null</span>
  <span class="c1">//                )</span>
  <span class="c1">//                .nickname(nickname)</span>
  <span class="c1">//                .loginType(loginType)</span>
  <span class="c1">//                .profileImageUrl(profileImageUrl)</span>
  <span class="c1">//                .apiKey(UUID.randomUUID().toString())</span>
  <span class="c1">//                .role(MemberRole.ROLE_USER)</span>
  <span class="c1">//                .status(MemberStatus.ACTIVE)</span>
  <span class="c1">//                .build();</span>
  <span class="c1">//</span>
  <span class="c1">//        if (providerId != null) {</span>
  <span class="c1">//            _connectProviderToMember(member, loginType, providerId, providerEmail);</span>
  <span class="c1">//        }</span>
  <span class="c1">//</span>
  <span class="c1">//        return memberRepository.save(member);</span>
  <span class="c1">//    }</span>
        
      <span class="kd">public</span> <span class="nc">Optional</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="nf">findByEmail</span><span class="o">(</span><span class="nc">String</span> <span class="n">email</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">return</span> <span class="n">memberRepository</span><span class="o">.</span><span class="na">findByEmail</span><span class="o">(</span><span class="n">email</span><span class="o">);</span>
      <span class="o">}</span>
        
      <span class="kd">public</span> <span class="nc">Optional</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="nf">findByApiKey</span><span class="o">(</span><span class="nc">String</span> <span class="n">apiKey</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">return</span> <span class="n">memberRepository</span><span class="o">.</span><span class="na">findByApiKey</span><span class="o">(</span><span class="n">apiKey</span><span class="o">);</span>
      <span class="o">}</span>
        
      <span class="kd">public</span> <span class="nc">String</span> <span class="nf">genAccessToken</span><span class="o">(</span><span class="nc">Member</span> <span class="n">member</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">return</span> <span class="n">authTokenService</span><span class="o">.</span><span class="na">genAccessToken</span><span class="o">(</span><span class="n">member</span><span class="o">);</span>
      <span class="o">}</span>
        
      <span class="kd">public</span> <span class="nc">String</span> <span class="nf">genAuthToken</span><span class="o">(</span><span class="nc">Member</span> <span class="n">member</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">return</span> <span class="n">member</span><span class="o">.</span><span class="na">getApiKey</span><span class="o">()</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="n">genAccessToken</span><span class="o">(</span><span class="n">member</span><span class="o">);</span>
      <span class="o">}</span>
        
      <span class="kd">public</span> <span class="nc">Member</span> <span class="nf">getMemberFromAccessToken</span><span class="o">(</span><span class="nc">String</span> <span class="n">accessToken</span><span class="o">)</span> <span class="o">{</span>
          <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="n">payload</span> <span class="o">=</span> <span class="n">authTokenService</span><span class="o">.</span><span class="na">payload</span><span class="o">(</span><span class="n">accessToken</span><span class="o">);</span>
          <span class="k">if</span> <span class="o">(</span><span class="n">payload</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
              <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
          <span class="o">}</span>
          <span class="kt">long</span> <span class="n">id</span> <span class="o">=</span> <span class="o">(</span><span class="kt">long</span><span class="o">)</span> <span class="n">payload</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"id"</span><span class="o">);</span>
          <span class="nc">String</span> <span class="n">email</span> <span class="o">=</span> <span class="o">(</span><span class="nc">String</span><span class="o">)</span> <span class="n">payload</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"email"</span><span class="o">);</span>
          <span class="nc">String</span> <span class="n">nickname</span> <span class="o">=</span> <span class="o">(</span><span class="nc">String</span><span class="o">)</span> <span class="n">payload</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"nickname"</span><span class="o">);</span>
          <span class="nc">String</span> <span class="n">profileImageUrl</span> <span class="o">=</span> <span class="o">(</span><span class="nc">String</span><span class="o">)</span> <span class="n">payload</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"profileImageUrl"</span><span class="o">);</span>
          <span class="nc">String</span> <span class="n">role</span> <span class="o">=</span> <span class="o">(</span><span class="nc">String</span><span class="o">)</span> <span class="n">payload</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"role"</span><span class="o">);</span>
        
          <span class="k">return</span> <span class="k">new</span> <span class="nf">Member</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="n">email</span><span class="o">,</span> <span class="n">nickname</span><span class="o">,</span> <span class="n">profileImageUrl</span><span class="o">,</span> <span class="nc">MemberRole</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">role</span><span class="o">));</span>
      <span class="o">}</span>
        
      <span class="kd">public</span> <span class="nc">FindEmailsResponse</span> <span class="nf">findEmailsByPhoneNumber</span><span class="o">(</span><span class="nc">String</span> <span class="n">phoneNumber</span><span class="o">)</span> <span class="o">{</span>
          <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="n">members</span> <span class="o">=</span> <span class="n">memberRepository</span><span class="o">.</span><span class="na">findAllByPhoneNumber</span><span class="o">(</span><span class="n">phoneNumber</span><span class="o">);</span>
          <span class="k">if</span> <span class="o">(</span><span class="n">members</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
              <span class="k">throw</span> <span class="k">new</span> <span class="nf">ServiceException</span><span class="o">(</span><span class="nc">ErrorCode</span><span class="o">.</span><span class="na">INVALID_PHONE_NUMBER</span><span class="o">);</span>
          <span class="o">}</span>
        
          <span class="nc">List</span><span class="o">&lt;</span><span class="nc">EmailInfo</span><span class="o">&gt;</span> <span class="n">emailInfos</span> <span class="o">=</span> <span class="n">members</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
              <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">member</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="nc">EmailInfo</span><span class="o">(</span>
                  <span class="nc">Ut</span><span class="o">.</span><span class="na">str</span><span class="o">.</span><span class="na">maskEmail</span><span class="o">(</span><span class="n">member</span><span class="o">.</span><span class="na">getEmail</span><span class="o">()),</span>
                  <span class="n">member</span><span class="o">.</span><span class="na">getCreateDate</span><span class="o">()</span>
              <span class="o">))</span>
              <span class="o">.</span><span class="na">toList</span><span class="o">();</span>
        
          <span class="k">return</span> <span class="k">new</span> <span class="nf">FindEmailsResponse</span><span class="o">(</span><span class="n">emailInfos</span><span class="o">);</span>
      <span class="o">}</span>
        
      <span class="nd">@Transactional</span>
      <span class="kd">public</span> <span class="nc">Member</span> <span class="nf">handleSocialLogin</span><span class="o">(</span>
          <span class="nc">String</span> <span class="n">email</span><span class="o">,</span> <span class="nc">String</span> <span class="n">nickname</span><span class="o">,</span>
          <span class="nc">ProviderType</span> <span class="n">loginType</span><span class="o">,</span> <span class="nc">String</span> <span class="n">profilePath</span><span class="o">,</span> <span class="nc">String</span> <span class="n">providerId</span>
      <span class="o">)</span> <span class="o">{</span>
          <span class="nc">Member</span> <span class="n">connectedMember</span> <span class="o">=</span> <span class="n">oAuthService</span><span class="o">.</span><span class="na">findByProviderId</span><span class="o">(</span><span class="n">loginType</span><span class="o">,</span> <span class="n">providerId</span><span class="o">);</span>
          <span class="k">if</span> <span class="o">(</span><span class="n">connectedMember</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
              <span class="n">connectedMember</span><span class="o">.</span><span class="na">setLoginType</span><span class="o">(</span><span class="n">loginType</span><span class="o">);</span>
              <span class="k">return</span> <span class="n">connectedMember</span><span class="o">;</span>  <span class="c1">// 연결된 계정이 있다면 그 계정으로 로그인</span>
          <span class="o">}</span>
        
          <span class="nc">Optional</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="n">existingMember</span> <span class="o">=</span> <span class="n">findByEmail</span><span class="o">(</span><span class="n">email</span><span class="o">);</span> <span class="c1">// 이메일이 사용중인지 확인</span>
          <span class="k">if</span> <span class="o">(</span><span class="n">existingMember</span><span class="o">.</span><span class="na">isPresent</span><span class="o">())</span> <span class="o">{</span>
              <span class="nc">Member</span> <span class="n">member</span> <span class="o">=</span> <span class="n">existingMember</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
              <span class="n">oAuthService</span><span class="o">.</span><span class="na">connectProvider</span><span class="o">(</span><span class="n">member</span><span class="o">,</span> <span class="n">loginType</span><span class="o">,</span> <span class="n">providerId</span><span class="o">,</span> <span class="n">email</span><span class="o">);</span>  <span class="c1">// 기존 계정에 소셜 계정 연결</span>
              <span class="k">return</span> <span class="n">member</span><span class="o">;</span>
          <span class="o">}</span>
        
          <span class="k">return</span> <span class="nf">signup</span><span class="o">(</span><span class="n">email</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="n">nickname</span><span class="o">,</span> <span class="n">loginType</span><span class="o">,</span> <span class="n">providerId</span><span class="o">,</span> <span class="n">email</span><span class="o">,</span> <span class="n">profilePath</span><span class="o">);</span>
      <span class="o">}</span>
        
  <span class="c1">//    @Transactional</span>
  <span class="c1">//    public Member handleSocialLogin(</span>
  <span class="c1">//        String email, String nickname,</span>
  <span class="c1">//        ProviderType loginType, String profilePath, String providerId</span>
  <span class="c1">//    ) {</span>
  <span class="c1">//        Member connectedMember = _findMemberByProviderId(loginType, providerId);</span>
  <span class="c1">//        if (connectedMember != null) {</span>
  <span class="c1">//            connectedMember.setLoginType(loginType);</span>
  <span class="c1">//            return connectedMember;  // 연결된 계정이 있다면 그 계정으로 로그인</span>
  <span class="c1">//        }</span>
  <span class="c1">//</span>
  <span class="c1">//        Optional&lt;Member&gt; existingMember = findByEmail(email); // 이메일이 사용중인지 확인</span>
  <span class="c1">//        if (existingMember.isPresent()) {</span>
  <span class="c1">//            Member member = existingMember.get();</span>
  <span class="c1">//            _connectProviderToMember(member, loginType, providerId, email);  // 기존 계정에 소셜 계정 연결</span>
  <span class="c1">//            return member;</span>
  <span class="c1">//        }</span>
  <span class="c1">//</span>
  <span class="c1">//        return signup(email, null, nickname, loginType, providerId, email, profilePath);</span>
  <span class="c1">//    }</span>
        
  <span class="c1">//    @Transactional</span>
  <span class="c1">//    public void connectOAuthProvider2(</span>
  <span class="c1">//            Member loginUser, ProviderType loginType, String providerId, String providerEmail</span>
  <span class="c1">//        ) {</span>
  <span class="c1">//        Member connectedMember = _findMemberByProviderId(loginType, providerId);</span>
  <span class="c1">//        if (connectedMember != null) {</span>
  <span class="c1">//            throw new ServiceException(ErrorCode.SOCIAL_ACCOUNT_ALREADY_IN_USE);</span>
  <span class="c1">//        }</span>
  <span class="c1">//        _connectProviderToMember(loginUser, loginType, providerId, providerEmail);</span>
  <span class="c1">//    }</span>
        
      <span class="nd">@Transactional</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">connectOAuthProvider</span><span class="o">(</span>
          <span class="nc">Member</span> <span class="n">loginUser</span><span class="o">,</span> <span class="nc">ProviderType</span> <span class="n">loginType</span><span class="o">,</span> <span class="nc">String</span> <span class="n">providerId</span><span class="o">,</span> <span class="nc">String</span> <span class="n">providerEmail</span>
      <span class="o">)</span> <span class="o">{</span>
          <span class="nc">Member</span> <span class="n">connectedMember</span> <span class="o">=</span> <span class="n">oAuthService</span><span class="o">.</span><span class="na">findByProviderId</span><span class="o">(</span><span class="n">loginType</span><span class="o">,</span> <span class="n">providerId</span><span class="o">);</span>
          <span class="k">if</span> <span class="o">(</span><span class="n">connectedMember</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
              <span class="k">throw</span> <span class="k">new</span> <span class="nf">ServiceException</span><span class="o">(</span><span class="nc">ErrorCode</span><span class="o">.</span><span class="na">SOCIAL_ACCOUNT_ALREADY_IN_USE</span><span class="o">);</span>
          <span class="o">}</span>
          <span class="n">oAuthService</span><span class="o">.</span><span class="na">connectProvider</span><span class="o">(</span><span class="n">loginUser</span><span class="o">,</span> <span class="n">loginType</span><span class="o">,</span> <span class="n">providerId</span><span class="o">,</span> <span class="n">providerEmail</span><span class="o">);</span>
      <span class="o">}</span>
        
      <span class="kd">private</span> <span class="kt">void</span> <span class="nf">_validateEmailAndPassword</span><span class="o">(</span><span class="nc">String</span> <span class="n">email</span><span class="o">,</span> <span class="nc">String</span> <span class="n">password</span><span class="o">,</span> <span class="nc">ProviderType</span> <span class="n">loginType</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">if</span> <span class="o">(</span><span class="n">email</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">email</span><span class="o">.</span><span class="na">trim</span><span class="o">().</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
              <span class="k">throw</span> <span class="k">new</span> <span class="nf">ServiceException</span><span class="o">(</span><span class="nc">ErrorCode</span><span class="o">.</span><span class="na">EMAIL_REQUIRED</span><span class="o">);</span>
          <span class="o">}</span>
        
          <span class="k">if</span> <span class="o">(</span><span class="nc">ProviderType</span><span class="o">.</span><span class="na">SELF</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">loginType</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="n">password</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">password</span><span class="o">.</span><span class="na">trim</span><span class="o">().</span><span class="na">isEmpty</span><span class="o">()))</span> <span class="o">{</span>
              <span class="k">throw</span> <span class="k">new</span> <span class="nf">ServiceException</span><span class="o">(</span><span class="nc">ErrorCode</span><span class="o">.</span><span class="na">PASSWORD_REQUIRED</span><span class="o">);</span>
          <span class="o">}</span>
      <span class="o">}</span>
        
      <span class="kd">private</span> <span class="kt">void</span> <span class="nf">_connectProviderToMember</span><span class="o">(</span>
          <span class="nc">Member</span> <span class="n">member</span><span class="o">,</span> <span class="nc">ProviderType</span> <span class="n">loginType</span><span class="o">,</span>
          <span class="nc">String</span> <span class="n">providerId</span><span class="o">,</span> <span class="nc">String</span> <span class="n">providerEmail</span>
      <span class="o">)</span> <span class="o">{</span>
          <span class="nc">SocialAccount</span> <span class="n">socialAccount</span> <span class="o">=</span> <span class="n">member</span><span class="o">.</span><span class="na">getSocialAccountOrCreate</span><span class="o">();</span>
        
          <span class="k">switch</span> <span class="o">(</span><span class="n">loginType</span><span class="o">)</span> <span class="o">{</span>
              <span class="k">case</span> <span class="nc">ProviderType</span><span class="o">.</span><span class="na">KAKAO</span> <span class="o">-&gt;</span> <span class="n">socialAccount</span><span class="o">.</span><span class="na">connectKakao</span><span class="o">(</span><span class="n">providerId</span><span class="o">,</span> <span class="n">providerEmail</span><span class="o">);</span>
              <span class="k">case</span> <span class="nc">ProviderType</span><span class="o">.</span><span class="na">GOOGLE</span> <span class="o">-&gt;</span> <span class="n">socialAccount</span><span class="o">.</span><span class="na">connectGoogle</span><span class="o">(</span><span class="n">providerId</span><span class="o">,</span> <span class="n">providerEmail</span><span class="o">);</span>
              <span class="k">case</span> <span class="nc">ProviderType</span><span class="o">.</span><span class="na">GITHUB</span> <span class="o">-&gt;</span> <span class="n">socialAccount</span><span class="o">.</span><span class="na">connectGithub</span><span class="o">(</span><span class="n">providerId</span><span class="o">,</span> <span class="n">providerEmail</span><span class="o">);</span>
              <span class="k">case</span> <span class="nc">ProviderType</span><span class="o">.</span><span class="na">NAVER</span> <span class="o">-&gt;</span> <span class="n">socialAccount</span><span class="o">.</span><span class="na">connectNaver</span><span class="o">(</span><span class="n">providerId</span><span class="o">,</span> <span class="n">providerEmail</span><span class="o">);</span>
          <span class="o">}</span>
      <span class="o">}</span>
        
      <span class="kd">private</span> <span class="nc">Member</span> <span class="nf">_findMemberByProviderId</span><span class="o">(</span><span class="nc">ProviderType</span> <span class="n">loginType</span><span class="o">,</span> <span class="nc">String</span> <span class="n">providerId</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">return</span> <span class="nf">switch</span> <span class="o">(</span><span class="n">loginType</span><span class="o">)</span> <span class="o">{</span>
              <span class="k">case</span> <span class="nc">ProviderType</span><span class="o">.</span><span class="na">KAKAO</span> <span class="o">-&gt;</span> <span class="n">memberRepository</span><span class="o">.</span><span class="na">findByKakaoProviderId</span><span class="o">(</span><span class="n">providerId</span><span class="o">).</span><span class="na">orElse</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
              <span class="k">case</span> <span class="nc">ProviderType</span><span class="o">.</span><span class="na">GOOGLE</span> <span class="o">-&gt;</span> <span class="n">memberRepository</span><span class="o">.</span><span class="na">findByGoogleProviderId</span><span class="o">(</span><span class="n">providerId</span><span class="o">).</span><span class="na">orElse</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
              <span class="k">case</span> <span class="nc">ProviderType</span><span class="o">.</span><span class="na">GITHUB</span> <span class="o">-&gt;</span> <span class="n">memberRepository</span><span class="o">.</span><span class="na">findByGithubProviderId</span><span class="o">(</span><span class="n">providerId</span><span class="o">).</span><span class="na">orElse</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
              <span class="k">case</span> <span class="nc">ProviderType</span><span class="o">.</span><span class="na">NAVER</span> <span class="o">-&gt;</span> <span class="n">memberRepository</span><span class="o">.</span><span class="na">findByNaverProviderId</span><span class="o">(</span><span class="n">providerId</span><span class="o">).</span><span class="na">orElse</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
              <span class="k">default</span> <span class="o">-&gt;</span> <span class="kc">null</span><span class="o">;</span>
          <span class="o">};</span>
      <span class="o">}</span>
        
  <span class="o">}</span>
        
</pre></table></code></div></div></div></details><li>s</ul></ul><h3 id="-baseoauthprovider-1"><span class="me-2">🔆 BaseOAuthProvider</span><a href="#-baseoauthprovider-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>    
</pre></table></code></div></div><ul><li>s</ul></ul><h3 id="-baseoauthprovider-2"><span class="me-2">🔆 BaseOAuthProvider</span><a href="#-baseoauthprovider-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>    
</pre></table></code></div></div><ul><li>s</ul></ul><h3 id="-baseoauthprovider-3"><span class="me-2">🔆 BaseOAuthProvider</span><a href="#-baseoauthprovider-3" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>    
</pre></table></code></div></div><ul><li>s</ul></ul><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">com.msa.member.domain.member.member.enums</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">lombok.Getter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.RequiredArgsConstructor</span><span class="o">;</span>

<span class="nd">@Getter</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="kd">public</span> <span class="kd">enum</span> <span class="nc">MemberStatus</span> <span class="o">{</span>
  <span class="no">ACTIVE</span><span class="o">(</span><span class="s">"정상"</span><span class="o">),</span>
  <span class="no">INACTIVE</span><span class="o">(</span><span class="s">"휴면"</span><span class="o">),</span>
  <span class="no">BANNED</span><span class="o">(</span><span class="s">"정지"</span><span class="o">),</span>
  <span class="no">WITHDRAWN</span><span class="o">(</span><span class="s">"탈퇴"</span><span class="o">);</span>

  <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">description</span><span class="o">;</span>

  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">canLogin</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span> <span class="o">==</span> <span class="no">ACTIVE</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>

</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">com.msa.member.domain.member.member.enums</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">lombok.Getter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.RequiredArgsConstructor</span><span class="o">;</span>

<span class="nd">@Getter</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="kd">public</span> <span class="kd">enum</span> <span class="nc">ProviderType</span> <span class="o">{</span>
  <span class="no">SELF</span><span class="o">(</span><span class="s">"일반"</span><span class="o">),</span>
  <span class="no">KAKAO</span><span class="o">(</span><span class="s">"카카오"</span><span class="o">),</span>
  <span class="no">GOOGLE</span><span class="o">(</span><span class="s">"구글"</span><span class="o">),</span>
  <span class="no">NAVER</span><span class="o">(</span><span class="s">"네이버"</span><span class="o">),</span>
  <span class="no">GITHUB</span><span class="o">(</span><span class="s">"깃허브"</span><span class="o">);</span>

  <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">displayName</span><span class="o">;</span>
<span class="o">}</span>

</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/member-module/">Member Module</a>, <a href="/categories/refactoring/">Refactoring</a>, <a href="/categories/%EA%B2%B0%EA%B3%BC/">결과</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/%EB%A9%8B%EC%9F%81%EC%9D%B4-%EC%82%AC%EC%9E%90%EC%B2%98%EB%9F%BC/" class="post-tag no-text-decoration" >멋쟁이 사자처럼</a> <a href="/tags/spring-security/" class="post-tag no-text-decoration" >Spring Security</a> <a href="/tags/member/" class="post-tag no-text-decoration" >Member</a> <a href="/tags/%EC%9D%B8%EC%A6%9D-%EC%9D%B8%EA%B0%80/" class="post-tag no-text-decoration" >인증/인가</a> <a href="/tags/refactoring/" class="post-tag no-text-decoration" >Refactoring</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> 이 기사는 저작권자의 <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> 라이센스를 따릅니다.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">공유하기</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Member%20%EB%AA%A8%EB%93%88%20%EB%A6%AC%ED%8E%99%ED%86%A0%EB%A7%81%20-%201%EB%8B%A8%EA%B3%84%20-%20%EB%A6%AC%EB%B2%84&url=https%3A%2F%2Fbacknback.github.io%2Fposts%2Fmember-module-2%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fa-brands fa-square-x-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Member%20%EB%AA%A8%EB%93%88%20%EB%A6%AC%ED%8E%99%ED%86%A0%EB%A7%81%20-%201%EB%8B%A8%EA%B3%84%20-%20%EB%A6%AC%EB%B2%84&u=https%3A%2F%2Fbacknback.github.io%2Fposts%2Fmember-module-2%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fbacknback.github.io%2Fposts%2Fmember-module-2%2F&text=Member%20%EB%AA%A8%EB%93%88%20%EB%A6%AC%ED%8E%99%ED%86%A0%EB%A7%81%20-%201%EB%8B%A8%EA%B3%84%20-%20%EB%A6%AC%EB%B2%84" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="링크 복사하기" data-title-succeed="링크가 복사되었습니다!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 mb-5 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">최근 업데이트</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/member-module-1/">Member 모듈 리펙토링 - 개요 및 진행상황</a><li class="text-truncate lh-lg"> <a href="/posts/member-module-2/">Member 모듈 리펙토링 - 1단계</a><li class="text-truncate lh-lg"> <a href="/posts/spring-security2/">Spring Security 탐구 - 동작 원리</a><li class="text-truncate lh-lg"> <a href="/posts/spring-security/">Spring Security 탐구 - 개요</a><li class="text-truncate lh-lg"> <a href="/posts/jwt/">JWT 인증 / 인가</a></ul></section><section><h2 class="panel-heading">인기 태그</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/docker/">Docker</a> <a class="post-tag btn btn-outline-primary" href="/tags/spring-security/">Spring Security</a> <a class="post-tag btn btn-outline-primary" href="/tags/%EB%A9%8B%EC%9F%81%EC%9D%B4-%EC%82%AC%EC%9E%90%EC%B2%98%EB%9F%BC/">멋쟁이 사자처럼</a> <a class="post-tag btn btn-outline-primary" href="/tags/mysql/">MySQL</a> <a class="post-tag btn btn-outline-primary" href="/tags/refactoring/">Refactoring</a> <a class="post-tag btn btn-outline-primary" href="/tags/%EC%9D%B8%EC%A6%9D-%EC%9D%B8%EA%B0%80/">인증/인가</a> <a class="post-tag btn btn-outline-primary" href="/tags/grasp/">GRASP</a> <a class="post-tag btn btn-outline-primary" href="/tags/ncp/">NCP</a> <a class="post-tag btn btn-outline-primary" href="/tags/server/">Server</a> <a class="post-tag btn btn-outline-primary" href="/tags/springconfig/">SpringConfig</a></div></section></div><section id="toc-wrapper" class="ps-0 pe-4"><h2 class="panel-heading ps-3 mb-2">바로가기</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">관련된 글</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/member-module-1/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1739768400" data-df="YYYY/MM/DD" > 2025/02/17 </time><h4 class="pt-0 my-2">Member 모듈 리펙토링 - 개요 및 진행상황</h4><div class="text-muted"><p>프로젝트 때 만든 Member 모듈을 재사용이 가능하도록 완성하는 과정</p></div></div></a></article><article class="col"> <a href="/posts/spring-security2/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1739592000" data-df="YYYY/MM/DD" > 2025/02/15 </time><h4 class="pt-0 my-2">Spring Security 탐구 - 동작 원리</h4><div class="text-muted"><p>세부 내용 이전에 전체적인 내부 동작 원리를 파악하기</p></div></div></a></article><article class="col"> <a href="/posts/spring-security/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1739505600" data-df="YYYY/MM/DD" > 2025/02/14 </time><h4 class="pt-0 my-2">Spring Security 탐구 - 개요</h4><div class="text-muted"><p>프로젝트에서 경험한 Spring Security에 대하여 더 알고 싶어 공부하는 글글</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/member-module-1/" class="btn btn-outline-primary" aria-label="이전 글" ><p>Member 모듈 리펙토링 - 개요 및 진행상황</p></a><div class="btn btn-outline-primary disabled" aria-label="다음 글"><p>-</p></div></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://github.com/backnback">이가람</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="명시되지 않는 한 이 사이트의 블로그 게시물은 작성자의 Creative Commons Attribution 4.0 International(CC BY 4.0) 라이선스에 따라 사용이 허가되었습니다." >일부 권리 보유</span></p><p>Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.2.4" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">인기 태그</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/docker/">Docker</a> <a class="post-tag btn btn-outline-primary" href="/tags/spring-security/">Spring Security</a> <a class="post-tag btn btn-outline-primary" href="/tags/%EB%A9%8B%EC%9F%81%EC%9D%B4-%EC%82%AC%EC%9E%90%EC%B2%98%EB%9F%BC/">멋쟁이 사자처럼</a> <a class="post-tag btn btn-outline-primary" href="/tags/mysql/">MySQL</a> <a class="post-tag btn btn-outline-primary" href="/tags/refactoring/">Refactoring</a> <a class="post-tag btn btn-outline-primary" href="/tags/%EC%9D%B8%EC%A6%9D-%EC%9D%B8%EA%B0%80/">인증/인가</a> <a class="post-tag btn btn-outline-primary" href="/tags/grasp/">GRASP</a> <a class="post-tag btn btn-outline-primary" href="/tags/ncp/">NCP</a> <a class="post-tag btn btn-outline-primary" href="/tags/server/">Server</a> <a class="post-tag btn btn-outline-primary" href="/tags/springconfig/">SpringConfig</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">새 버전의 콘텐츠를 사용할 수 있습니다.</p><button type="button" class="btn btn-primary" aria-label="Update"> 업데이트 </button></div></aside><script> (function () { const origin = 'https://utteranc.es'; const themeMapper = Theme.getThemeMapper('github-light', 'github-dark'); const initTheme = themeMapper[Theme.visualState]; let script = document.createElement('script'); script.src = 'https://utteranc.es/client.js'; script.setAttribute('repo', 'backnback/comments'); script.setAttribute('issue-term', 'pathname'); script.setAttribute('theme', initTheme); script.crossOrigin = 'anonymous'; script.async = true; const $footer = document.querySelector('footer'); $footer.insertAdjacentElement('beforebegin', script); addEventListener('message', (event) => { let newTheme;if (event.source === window && event.data && event.data.id === Theme.ID) { newTheme = themeMapper[Theme.visualState]; const message = { type: 'set-theme', theme: newTheme }; const utterances = document.querySelector('.utterances-frame').contentWindow; utterances.postMessage(message, origin); } }); })(); </script> <script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">검색 결과가 없습니다.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
